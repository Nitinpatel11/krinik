<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Manage Match</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      content="Premium Multipurpose Admin & Dashboard Template"
      name="description"
    />
    <meta content="Themesdesign" name="author" />
    <!-- App favicon -->
    <!-- <link rel="shortcut icon" href="./assets/images/favicon.ico" /> -->
    <link rel="icon" href="./assets/images/krinikIn_Logo.svg" type="image/x-icon" >
    <!-- DataTables -->
    <link
      href="./assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <link
      href="./assets/libs/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css"
      rel="stylesheet"
      type="text/css"
    />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <!-- Responsive datatable examples -->
    <link
      href="./assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css"
      rel="stylesheet"
      type="text/css"
    />

    <!-- datepicker -->
    <link
      href="./assets/libs/air-datepicker/air-datepicker.css"
      rel="stylesheet"
      type="text/css"
    />

    <!-- jvectormap -->
    <link href="./assets/libs/jqvmap/jqvmap.min.css" rel="stylesheet" />

    <!-- Bootstrap Css -->
    <link
      href="./assets/css/bootstrap.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <!-- Icons Css -->
    <link href="./assets/css/icons.min.css" rel="stylesheet" type="text/css" />
    <!-- App Css-->
    <link href="./assets/css/app.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,300,0,0" />
  </head>

  <body data-topbar="colored">
    <!-- Begin page -->
    <div id="layout-wrapper">
      <header id="page-topbar" class="">
        <div class="navbar-header ">
          <div class="d-flex ">
            <!-- LOGO -->
            <div class="navbar-brand-box">
              <a href="./dashboard.html" class="logo logo-dark">
                <span class="logo-sm">
                  
                  <img src="./assets/images/krinikIn_Logo.svg" alt="" />
                </span>
                <span class="logo-lg">
                
                  <img src="./assets/images/krinikIn_Logo.svg" alt=""  />
                </span>
              </a>
  
              <a href="index.html" class="logo logo-light ">
                <span class="logo-sm">
               
                  <img src="./assets/images/krinikIn_Logo.svg" alt=""  />
                </span>
                <span class="logo-lg">
                  
                  <img src="./assets/images/krinikIn_Logo.svg" alt="" />
                </span>
              </a>
            </div>
  
            <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect " id="vertical-menu-btn">
              <i class="mdi mdi-backburger "></i>
            </button>
  
            <!-- App Search-->
            <!-- <form class="app-search d-none d-lg-block">
                              <div class="position-relative mt-3">
                                  <input type="text" class="form-control" placeholder="Search...">
                                  <span class="mdi mdi-magnify"></span>
                              </div>
                          </form> -->
          </div>
  
          <div class="  d-flex justify-content-center gap-4 time_show1">
            <div class="dropdown d-flex justify-content-end ms-2  " id="enterotpdiv">
              <!-- <button id="showotppage" type="button" class="btn btn-primary2  waves-effect" 
               >Enter OTP
              </button> -->
              
            </div>
          
            <div class="dropdown   dblock">
              <div id="time_show" class="btn-primary2  px-3">
              </div>
            </div>
  
            
          </div>
          
        </div>
      </header>
  
          <!-- ========== Left Sidebar Start ========== -->
     <div class="vertical-menu ">
      <div data-simplebar class="h-100 ">
        <!--- Sidemenu -->
        <div id="sidebar-menu" class="">
          <!-- Left Menu Start -->
          <ul class="metismenu list-unstyled " id="side-menu">
            <li class="menu-title">Menu</li>

            <li>
              <a href="./dashboard.html" class="waves-effect">
                <div class=" icons-sm icon-set">
                  <span class="material-symbols-outlined icon-margin">
                    dashboard
                    </span>
               
                <span>Dashboard</span>
                </div>
              </a>
            </li>

            <li>
              <a href="./user.html" class="waves-effect">
                <div class="icons-sm icon-set">
                  <span class="material-symbols-outlined icon-margin">
                    person
                    </span>
               
                <span>User</span>
              </div>
              </a>
            </li>

            <li>
              <a href="javascript: void(0);" class=" ">
                <div class="icons-sm icon-set ">
                  <span class="material-symbols-outlined icon-margin">
                    sports_cricket
                    </span>                    
                    <span class="has-arrow waves-effect ">Sports Configuration</span>
                                    
                  </div> 
                  
                </a>

              <ul class="sub-menu" aria-expanded="false">
                <li><a href="./manage-league.html">Manage Leagues</a></li>
                <li><a href="./manage-team.html">Manage Teams</a></li>
                <li><a href="./manage-player.html">Manage Players</a></li>
              </ul>
            </li>
            
            <li>
              <a href="javascript: void(0);" class=" ">
                <div class="icons-sm icon-set ">
                  <span class="material-symbols-outlined icon-margin">
                    crossword
                    </span>                   
                    <span class="has-arrow has-arrow1 waves-effect ">Manage Contest</span>
                                    
                  </div> 
                  
                </a>

              <ul class="sub-menu" aria-expanded="false">
                <li><a href="./manage-match.html">Manage Match</a></li>
                <li><a href="./manage-pool.html">Manage Pools</a></li>
              </ul>
            </li>

            <li class="otp-exempt" style="display:none">
              <a href="javascript: void(0);" class=" ">
                <div class="icons-sm icon-set ">
                  <span class="material-symbols-outlined icon-margin">
                    receipt_long
                    </span>                 
                    <span class="has-arrow has-arrow2 waves-effect ">Transactions</span>
                                    
                  </div> 
                  
                </a>

              <ul class="sub-menu" aria-expanded="false">
                <li><a href="./all-transaction.html">All Transaction</a></li>
                <li><a href="./wallet-transaction.html">Wallet Transaction</a></li>
                <li><a href="./game-transaction.html">Game Transaction</a></li>
              </ul>
            </li>

            <li class="otp-exempt" style="display:none">
              <a href="./account-setting.html" class="waves-effect">
                <div class="icons-sm icon-set ">
                  <span class="material-symbols-outlined icon-margin">
                    settings
                    </span>
                    <span>Account Setting</span>
                </div>
              </a>
            </li>

            <li>
              <a href="" class="waves-effect " id="logoutButton">
                <div class=" icons-sm icon-set ">
                  <span class="material-symbols-outlined icon-margin ">
                    logout
                    </span>
                    <span class="">Logout</span>
                </div>
              </a>
            </li>

          
                    </ul>
        </div>
        <!-- Sidebar -->
      </div>
    </div>
    <!-- Left Sidebar End -->

      <!-- ============================================================== -->
      <!-- Start right Content here -->
      <!-- ============================================================== -->
      <div class="main-content">
        <div class="page-content">
          <!-- Page-Title -->
          <div class="page-title-box">
            <div class="container-fluid">
              <div class="row align-items-center">
                <!-- <div class="col-md-8">
                                    <h4 class="page-title mb-1">Dashboard</h4>
                                    <ol class="breadcrumb m-0">
                                    <li class="breadcrumb-item active">Welcome to Xoric Dashboard</li>
                                    </ol>
                                </div>
                                <div class="col-md-4">
                                    <div class="float-end d-none d-md-block">
                                        <div class="dropdown d-inline-block">
                                            <button type="button" class="btn btn-light rounded-pill user text-start d-flex align-items-center" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                <i class="mdi mdi-settings-outline me-1"></i> Settings
                                            </button>
                                            <div class="dropdown-menu dropdown-menu-end">
                                                <a class="dropdown-item" href="#">Action</a>
                                                <a class="dropdown-item" href="#">Another action</a>
                                                <a class="dropdown-item" href="#">Something else here</a>
                                                <div class="dropdown-divider"></div>
                                                <a class="dropdown-item" href="#">Separated link</a>
                                            </div>
                                        </div>
                                    </div>
                                </div> -->
                <div>
                  <h4 class="page-title mb-1">Manage Match</h4>
                </div>
              </div>
            </div>
          </div>
          <!-- end page title end breadcrumb -->

          <div class="page-content-wrapper">
            <div class="container-fluid">
              <div class="row">
                <div class="col-xl-4">
                  <div class="card">
                    <div class="card-body">
                      <div class="row">
                        <div class="col-6">
                          <h5>Total Match</h5>
                          <!-- <p class="text-muted">Xoric Dashboard</p> -->

                          <div class="mt-4">
                            <span
                              href="#"
                              class="btn btn-primary btn-sm data-padding btn-font"
                              id="total-match-data"
                              >
                            </span>
                          </div>
                        </div>

                        <div class="col-5 ms-auto">
                          <div>
                            <img
                              src="./assets/images/widget-img.png"
                              alt=""
                              class="img-fluid"
                            />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12  d-flex justify-content-end">
                    <div class=" d-flex align-items-end  ">

                        <form class="app-search  d-lg-block d-flex  ">
                          <div class="d-flex gap-3 flex-wrap">
                             <div class="dropdown">

                      <!-- <div class="datepicker-container"> -->
                      <div id="rangePicker" class="date-button">Start & End Date
                      </div>
                      <i id="calendarIcon" class="fas fa-calendar-alt date-icon"></i>
                      <i id="clearDates" class="fas fa-times-circle"></i>
                      <!-- </div> -->

                      <!-- <i class="mdi mdi-chevron-down"></i> -->

                    </div>
                          <!-- <div class="dropdown">
                            <select id="leagueDropdown" class="form-select dropbtn-color dropbtn" onchange="filterRankList()">
                                <option value="">All Leagues</option>
                            </select>
                        </div> -->
                        <div class="dropdown">
                          <div id="dropdownBtn3" class="dropdown-btn3">
                            <span id="selectedStatus" data-value="All Status">All Status</span>
                            <span class="material-symbols-outlined arrow" id="arrowBar">stat_minus_1</span>
                            <span class="material-symbols-outlined circle-clear1" id="clearStatus">
                              cancel
                            </span>
    
                          </div>
                          <div id="dropdownContent3" class="dropdown-content3 ">
                            <!-- <a data-value="success">Success</a>
                            <a data-value="fail">Fail</a>
                            <a data-value="pending">Pending</a> -->
                            <a data-value="Running">Running</a>
                            <a data-value="Completed">Completed</a>
                            <a data-value="Upcoming">Upcoming</a>
                          </div>
                        </div>
                        
                        <div class="align-items-center d-flex dropbtn-color justify-content-between drop-padd">
                           <div> 
                          <span class="mdi mdi-magnify dropbtn-color-2"></span>
                        </div>  
                        <div>
                          <input type="text" class=" dropbtn-color-2" placeholder="Search..." id="tab_filter_text">
                        </div>
                        </div>
                        <div>
  
                          <a href="./add-match.html" type="button" class="btn dropbtn-color addnew" id="otpAdd">Add New</a>
                        </div>
                      </div>
                           
                        </form>
                    </div>
                </div>
              </div>
              <!-- end row -->

              <div class="row">
                <div class="container-fluid">
                  <div class="row">
                    <div class="col-12">
                      <div class="card">
                        <div class="card-body">
                          <div
                            id="datatable_wrapper"
                            class="dataTables_wrapper dt-bootstrap4 no-footer"
                          >
                            <div class="row">
                              <div class="table-rep-plugin">
                                <div
                                  class="table-responsive mb-0 table table-scroll"
                                  data-pattern="priority-columns" id="table-scrolling"
                                >
                                  <table
                                    id="matchTable"
                                    class="table table-striped text-center align-items-center fixed-table"
                                  >
                                    <thead class="align-items-center">
                                      <tr>
                                        <th data-priority="">No.</th>
                                        <th data-priority="" class="sortable" data-column="team_name" colspan="3">Match Name   
                                          
                                        </th>
                                        <th data-priority="" colspan="2">
                                         Total Pool
                                        </th>
                                        <th data-priority="" colspan="2">
                                          Fantacy Start
                                        </th>
                                        <th data-priority="" colspan="2">
                                          Fantacy End
                                        </th>
                                        <th data-priority="" colspan="3">Total Amount</th>
                                        <th data-priority="">
                                         Total Players
                                        </th>
                                        <th data-priority="" colspan="2">Status</th>
                                      
                                        <th data-priority="">View</th>

                                        <th data-priority="">Edit</th>
                                        <th data-priority="">Delete</th>
                                      </tr>
                                    </thead>
                                    <tbody ></tbody>
                                  </table>
                                
                                </div>
                                <div id="noDataFound" style="display:none;" class="no-data-div">
                                  <img src="./assets/images/no-data.jpg" alt="No Data Found">
                                </div>
                              </div>
                            </div>
                            <div class="row pagi" id="pagination" style="display:none">
                              <div class="col-sm-12 col-md-5">
                                <div class="dataTables_info" id="datatable_info" role="status" aria-live="polite">
                                  Showing 1 to 10 of 57 leagues
                                </div>
                              </div>
                              <div class="col-sm-12 col-md-7">
                                <div class="dataTables_paginate paging_simple_numbers pagination index_buttons"
                                  id="datatable_paginate">
                                  <ul class="pagination-list d-flex list-unstyled"></ul>
                                </div>
                              </div>
                            </div>
                            <div class="d-flex justify-content-end pagi">
                          
                              <button  type="button" id="download-btn" class="btn dropbtn-color addnew">Download Excel</button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <!-- end col -->
                  </div>
                  <!-- end row -->
                </div>
              </div>
              <!-- end row -->
            </div>
            <!-- container-fluid -->
          </div>
          <!-- end page-content-wrapper -->
        </div>
        <!-- End Page-content -->

        <footer class="footer">
          <div class="container-fluid">
            <div class="row">
              <div class="col-sm-6">2024 © Krinik.</div>
              <div class="col-sm-6">
                <div class="text-sm-end d-none d-sm-block">
                  Crafted with <i class="mdi mdi-heart text-danger"></i> by
                  Themesdesign
                </div>
              </div>
            </div>
          </div>
        </footer>
      </div>
      <!-- end main content-->
    </div>
    <!-- END layout-wrapper -->

   

    <!-- JAVASCRIPT -->
    <script src="./assets/libs/jquery/jquery.min.js"></script>
    <script src="./assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="./assets/libs/metismenu/metisMenu.min.js"></script>
    <script src="./assets/libs/simplebar/simplebar.min.js"></script>
    <script src="./assets/libs/node-waves/waves.min.js"></script>

    <script src="https://unicons.iconscout.com/release/v2.0.1/script/monochrome/bundle.js"></script>
    <script src="./assets/js/logout.js"></script>

    <!-- Required datatable js -->
    <script src="./assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="./assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
    <!-- Buttons examples -->
    <script src="./assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="./assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
    <script src="./assets/libs/jszip/jszip.min.js"></script>
    <!-- <script src="./assets/libs/pdfmake/build/pdfmake.min.js"></script> -->
    <!-- <script src="./assets/libs/pdfmake/build/vfs_fonts.js"></script> -->
    <script src="./assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="./assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="./assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
    <!-- Responsive examples -->
    <script src="./assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="./assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>

    <!-- datepicker -->
    <script src="./assets/libs/air-datepicker/air-datepicker.css"></script>
    <script src="./assets/libs/air-datepicker/air-datepicker.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <!-- apexcharts -->
    <!-- <script src="./assets/libs/apexcharts/apexcharts.min.js"></script> -->

    <script src="./assets/libs/jquery-knob/jquery.knob.min.js"></script>

    <!-- Jq vector map -->
    <!-- <script src="./assets/libs/jqvmap/jquery.vmap.min.js"></script> -->
    <!-- <script src="./assets/libs/jqvmap/maps/jquery.vmap.usa.js"></script> -->

    <script src="./assets/js/pages/dashboard.init.js"></script>

    <script src="./assets/js/app.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
  
    <!-- <script src="https://cdn.jsdelivr.net/npm/intersection-observer@latest/umd/intersection-observer.min.js"></script> -->
   
  
    <!-- <script src="https://unicons.iconscout.com/release/v2.0.1/script/monochrome/bundle.js"></script> -->

    
    <script>
      var rankList = [];
      var array = [];
      var array_length = 0;
      var table_size = 10;
      var start_index = 1;
      var end_index = 0;
      var current_index = 1;
      var max_index = 0;
      let totaldatamatch = document.querySelector("#total-match-data");
      let otpAdd = document.querySelector("#otpAdd");
  
      async function fetchData() {
          try {
              const response = await fetch("https://krinik.pythonanywhere.com/match_get/", {
                  method: "GET",
                  headers: {
                      'Content-Type': 'application/json'
                  }
              });
        //       const otpapi = await $.ajax({
        //   url: "https://krinik.pythonanywhere.com/send_otp_get/",
        //   method: "GET"
        // });
//         if (otpapi && otpapi.status === "success") {
//     // Access the first item in the data array
//     let otpApi1 = otpapi.data[0];
    
//     // Get the phone_number from the first item
//      otpApi = otpApi1.phone_number;
//      otpApi2 = otpApi1.otp
//     console.log(otpApi);
// }
  
              if (response.ok) {
                  const data = await response.json();
                  if (data && data.status === "success") {
                      rankList = data.data;
                      array = rankList; // Initialize array with fetched data
                      totaldatamatch.innerHTML = array.length;
                      console.log(array);
                      displayIndexButtons();
                  } else {
                      console.error("Error: Invalid data format");
                  }
              } else {
                  console.error("Error fetching data", response.statusText);
              }
          } catch (error) {
              console.error("Error fetching data", error);
          }
      }
      async function postPhoneNumber() {
  try {
    const response = await $.ajax({
      url: "https://krinik.pythonanywhere.com/send_otp_get/", // Change this to your POST endpoint
      method: "POST",
      contentType: "application/json",
      data: JSON.stringify({ phone_number: "7801804996"})
    });

    if (response && response.status === "success") {
      console.log("Phone number posted successfully");
    } else {
      console.error("Failed to post phone number", response);
    }
  } catch (error) {
    console.error("Error posting phone number:", error);
  }
}

async function phoneNumber() {
  try {
   
    const otpapi = await $.ajax({
          url: "https://krinik.pythonanywhere.com/send_otp_get/",
          method: "GET"
        });        

    if (otpapi && otpapi.status === "success" ) {
      let otpApi1 = otpapi.data[0];
    
    // Get the phone_number from the first item
     otpApi = otpApi1.phone_number;
     otpApi2 = otpApi1.otp
    console.log(otpApi);
      console.log("Phone number posted successfully");
    } else {
      console.error("Failed to post phone number", response);
    }
  } catch (error) {
    console.error("Error posting phone number:", error);
  }
}

      function preLoadCalculations() {
          array_length = array.length;
          max_index = Math.ceil(array_length / table_size);
      }
  
      $(document).ready(function () {
        const $dropdownBtn3 = $('#dropdownBtn3');
  const $dropdownContent3 = $('#dropdownContent3');
  const $selectedStatus = $('#selectedStatus');
  const $arrow = $('#arrowBar'); // Ensure this selector matches your HTML
  const $clearStatus = $('#clearStatus');

  function toggleDropdown() {
    const isExpanded = $dropdownContent3.toggleClass('show').hasClass('show');
    $dropdownBtn3.attr('aria-expanded', isExpanded);
  }

  // Click event for the selected status element to toggle the dropdown
  $selectedStatus.on('click', function() {
    toggleDropdown();
  });

  // Click event for the arrow to toggle the dropdown
  $arrow.on('click', function() {
    toggleDropdown();
  });

  // Click event for selecting an item from the dropdown
  $dropdownContent3.on('click', 'a', function() {
    const selectedValue = $(this).data('value');
    $selectedStatus.text(selectedValue).data('value', selectedValue);
    $dropdownContent3.removeClass('show');

    if (selectedValue === 'All Status') {
      $arrow.show();
      $clearStatus.hide();
    } else {
      $arrow.hide();
      $clearStatus.show();
    }
    filterRankList(); // Filter based on the selected status
  });

  // Click event for clearing the selected status
  $clearStatus.on('click', function() {
    $selectedStatus.text('All Status').data('value', 'All Status');
    $arrow.show();
    $clearStatus.hide();
    $dropdownContent3.removeClass('show'); // Hide the dropdown content
    $dropdownBtn3.attr('aria-expanded', 'false'); // Ensure dropdown button is collapsed
    filterRankList(); // Filter with the reset status
  });

  // Click event for closing the dropdown if clicked outside
  $(document).on('click', function(event) {
    if (!$selectedStatus.is(event.target) && !$selectedStatus.has(event.target).length && !$dropdownContent3.has(event.target).length && !$arrow.is(event.target) && !$clearStatus.is(event.target)) {
      $dropdownContent3.removeClass('show');
      $dropdownBtn3.attr('aria-expanded', 'false');
    }
  });


    // $('#tab_filter_text').on('input', function () {
    //     filterRankList();
    // });

    // $('#datefilter').on('apply.daterangepicker', function (ev, picker) {
    //     $(this).val(picker.startDate.format('DD/MM/YYYY') + ' - ' + picker.endDate.format('DD/MM/YYYY'));
    //     $('#clearDateBtn').show();
    //     filterRankList();
    // });

    // $('#datefilter').on('cancel.daterangepicker', function (ev, picker) {
    //     $(this).val('');
    //     $('#clearDateBtn').hide();
    //     filterRankList();
    // });

    // $('#clearDateBtn').click(function () {
    //     $('#datefilter').val('start & end date');
    //     $(this).hide();
    //     filterRankList();
    // });
    $('#tab_filter_text').on('input', filterRankList);
      let picker = flatpickr('#rangePicker', {
        mode: 'range',
        dateFormat: 'd-m-Y',
        onClose: function (selectedDates, dateStr, instance) {
          if (!selectedDates || selectedDates.length === 0) {
            instance.clear();
            $('#rangePicker').text('Start & End Date').removeClass('has-dates');
            $('#clearDates').hide();
            $('#calendarIcon').show();
          } else {
            $('#rangePicker').text(selectedDates.map(date => instance.formatDate(date, 'd-m-Y')).join(' - ')).addClass('has-dates');
            $('#clearDates').show();
            $('#calendarIcon').hide();
          }
          filterRankList();
        },
        clickOpens: false,
        allowInput: false
      });

      $('#rangePicker, #calendarIcon').click(function () {
        if (!$('#rangePicker').hasClass('has-dates')) {
          picker.open();
        }
      });

      $('#clearDates').click(function () {
        picker.clear();
        $('#rangePicker').text('Start & End Date').removeClass('has-dates');
        $('#clearDates').hide();
        $('#calendarIcon').show();
        filterRankList();
      });


    $('#statusDropdown').change(function () {
        filterRankList();
    });

    fetchData();
});
    
    function filterRankList() {
    var tab_filter_text = $("#tab_filter_text").val().toLowerCase().trim();
    // var datefilter = $('#datefilter').val();
    var datefilter = $('#rangePicker').text().trim();
    const statusFilter = $("#selectedStatus").data('value') || '';
    var startDate, endDate;

    // if (datefilter !== '' && datefilter !== 'start & end date') {
    //     var dates = datefilter.split(' - ');
    //     startDate = parseDate(dates[0] + ' 00:00');
    //     endDate = parseDate(dates[1] + ' 23:59');
    // }
    if (datefilter !== '' && datefilter !== 'Start & End Date') {
            var dates = datefilter.split(' - ');
            startDate = moment(dates[0], 'DD-MM-YYYY').toDate();
            console.log(startDate)
            endDate = moment(dates[1], 'DD-MM-YYYY').toDate();
        }

    var filteredArray = rankList.filter(function (object) {
        var matchesText = true, matchesStatus = true, matchesDate = true;

        if (tab_filter_text !== '') {
            matchesText = (object.match_display_name && object.match_display_name.toLowerCase().includes(tab_filter_text)) ;
        }

        // if (statusFilter !== '') {
        //     const status = getStatus(object.match_start_date, object.match_end_date);
        //     matchesStatus = (status.toLowerCase() === statusFilter);
        // }
        if (statusFilter !== 'All Status') {
          const status = getStatus(object.match_start_date, object.match_end_date);
        console.log(status)
        matchesStatus = (status === statusFilter);
        // console.log(matchesStatus ,"okli")
      }
        // if (datefilter !== '' && datefilter !== 'start & end date') {
        //     matchesDate = (parseDate(object.start_league_date) >= startDate && parseDate(object.end_league_date) <= endDate);
        // }

        if (startDate && endDate) {
                matchesDate = (moment(object.match_start_date, 'DD-MM-YYYY').toDate() >= startDate &&
                    moment(object.match_start_date, 'DD-MM-YYYY').toDate() <= endDate);
            }

            return matchesText && matchesStatus && matchesDate;
    });

    array = filteredArray;
    current_index = 1;
    displayIndexButtons();
    displayTableRows(); // Add this line to refresh the table
}
  
      // Function to get status based on start and end dates
//       function getStatus(start_date, end_date) {
//     var currentDate = new Date();
//     var startDate = parseDate(start_date);
//     var endDate = parseDate(end_date);

//     if (startDate < currentDate && currentDate <= endDate) {
//         return "Running";
//     } else if (startDate < currentDate && endDate < currentDate) {
//         return "Completed";
//     } else if (startDate > currentDate && endDate > currentDate) {
//         return "Upcoming";
//     } else {
//         return "Unknown";
//     }
// }
function getStatus(start_date, end_date) {
  var currentDate = new Date();
  var startDate = moment(start_date, "DD-MM-YYYY HH:mm:ss").toDate();
  var endDate = moment(end_date, "DD-MM-YYYY HH:mm:ss").toDate();

  if (startDate < currentDate && currentDate <= endDate) {
    return "Running";
  } else if (startDate < currentDate && endDate < currentDate) {
    return "Completed";
  } else if (startDate > currentDate && endDate > currentDate) {
    return "Upcoming";
  } else {
    return "unknown";
  }
}

      function parseDate(dateStr) {
    var parts = dateStr.split(/[- :]/);
    return new Date(parts[2], parts[1] - 1, parts[0], parts[3] || 0, parts[4] || 0);
}
      function displayIndexButtons() {
      preLoadCalculations();
      $(".index_buttons ul").empty();

      // Check if the current page is not the first page
      if (current_index > 1) {
        $(".index_buttons ul").append('<button class="paginate_button page-item previous" onclick="prev()">Previous</button>');
      }

      // Display the first two pages
      $(".index_buttons ul").append('<button class="paginate_button page-item" onclick="indexPagination(1)" data-index="1">1</button>');
      if (max_index > 1) {
        $(".index_buttons ul").append('<button class="paginate_button page-item" onclick="indexPagination(2)" data-index="2">2</button>');
      }

      if (max_index > 3) {
        // Add ellipsis if there are pages between the second and the current page
        // if (current_index > 3) {
        //     $(".index_buttons ul").append('<span class="ellipsis">...</span>');
        // }
        if (current_index > 3 && current_index < max_index - 2) {
          $(".index_buttons ul").append('<span class="ellipsis">...</span>');
          $(".index_buttons ul").append('<span class="ellipsis">...</span>');
        } else if (current_index > 3) {
          $(".index_buttons ul").append('<span class="ellipsis">...</span>');
        } else if (current_index < max_index - 2) {
          $(".index_buttons ul").append('<span class="ellipsis">...</span>');
        }
        // Display the current page if it's not one of the first two pages or the last page
        if (current_index > 2 && current_index < max_index) {
          $(".index_buttons ul").append('<button class="paginate_button page-item" onclick="indexPagination(' + current_index + ')" data-index="' + current_index + '">' + current_index + '</button>');
        }

        // Add ellipsis if there are pages between the current page and the last page
        // if (current_index < max_index - 2) {
        //     $(".index_buttons ul").append('<span class="ellipsis">...</span>');
        // }

        // Display the last page
        $(".index_buttons ul").append('<button class="paginate_button page-item" onclick="indexPagination(' + max_index + ')" data-index="' + max_index + '">' + max_index + '</button>');
      } else if (max_index == 3) {
        $(".index_buttons ul").append('<button class="paginate_button page-item" onclick="indexPagination(3)" data-index="3">3</button>');
      }

      // Check if the current page is not the last page
      if (current_index < max_index) {
        $(".index_buttons ul").append('<button class="paginate_button page-item next" onclick="next()">Next</button>');
      }

      highlightIndexButton();
    }

    function highlightIndexButton() {
      start_index = (current_index - 1) * table_size + 1;
      end_index = Math.min(start_index + table_size - 1, array_length);
      $("#datatable_info").text("Showing " + start_index + " to " + end_index + " of " + array_length + " leagues");
      $(".index_buttons ul button").removeClass("active");
      $('.index_buttons ul button').each(function () {
        if ($(this).text() == current_index) {
          $(this).addClass("active");
        }
      });
      displayTableRows();
    }

    const adminType =  JSON.parse(localStorage.getItem('adminType'))
   const adminVal = adminType.value
   const statusType =  adminType.status



   function initializePage1() {
    // HTML for mobile number section and OTP modal
    const otpModalHTML = `
    <div id="otpModal" class="modal" style="display:none;z-index:2000">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>OTP Verification</h2>
            <div class="col-md-12 d-flex justify-content-between align-items-center">
                <div class="form-group form-group-custom">
                    <input type="text" class="form-control" id="mobilenum" value="Mobile No. 7801804996" readonly style="text-align: center;" />
                </div>
                <div class="text-center">
                    <button class="btn btn-primary" id="get-otp-btn">Get OTP</button>
                </div>
            </div>
            <div id="showotptimer" style="display:none;">
                <div class="otp-inputs text-center">
                    <input type="text" maxlength="1" class="otp-input" />
                    <input type="text" maxlength="1" class="otp-input" />
                    <input type="text" maxlength="1" class="otp-input" />
                    <input type="text" maxlength="1" class="otp-input" />
                    <input type="text" maxlength="1" class="otp-input" />
                    <input type="text" maxlength="1" class="otp-input" />
                </div>
                <p class="resend-timer text-end">
                    Resend in <span id="timer">30</span> sec
                    <button id="resend-otp-btn" style="display:none;">Resend OTP</button>
                </p>
                <button id="submitOTP" class="btn btn-primary">Submit</button>
                <p id="otpError" style="color:red;display:none;">Invalid OTP. Please try again.</p>
            </div>
        </div>
        <div id="otpOverlay" class="overlay" style="display:none;"></div>
    </div>`;

    document.body.insertAdjacentHTML('beforeend', otpModalHTML);

    // Get elements for OTP modal
    const otpModal = document.getElementById("otpModal");
    const otpOverlay = document.getElementById("otpOverlay");
    const closeModal = otpModal.querySelector(".close");
    const submitOTP = document.getElementById("submitOTP");
    const otpError = document.getElementById("otpError");
    const timerElement = document.getElementById('timer');
    const timerElement1 = document.getElementById('showotptimer');
    const resendOtpButton = document.getElementById('resend-otp-btn');

    function showOTPModal() {
      otpModal.style.display = "block";
      otpOverlay.style.display = "block";
      startTimer();
    
  }
  function showOTPModal1() {
    timerElement1.style.display = "block";
    otpOverlay.style.display = "block";
    
}

    function hideOTPModal() {
        otpModal.style.display = "none";
        otpOverlay.style.display = "none";
        resetTimer(); // Reset the timer when hiding the modal
    }

    function validateOTP(otp) {
        let otpsend = String(otpApi2); // Ensure otpApi2 is a string

        if (otp === otpsend) {
            otpError.style.display = "none"; // Hide error if OTP is valid
            return true;
        } else {
            otpError.style.display = "block"; // Show error if OTP is invalid
            return false;
        }
    }

    let timerIntervalId = null;

    function startTimer() {
        let time = 30; // Timer duration in seconds

        if (timerIntervalId !== null) {
            clearInterval(timerIntervalId);
        }

        timerIntervalId = setInterval(() => {
            time--;
            timerElement.textContent = time;
            if (time <= 0) {
                clearInterval(timerIntervalId);
                timerElement.textContent = '0';
                resendOtpButton.style.display = 'inline-block'; // Show the resend button
            }
        }, 1000);
    }

    function resetTimer() {
        if (timerIntervalId !== null) {
            clearInterval(timerIntervalId);
            timerIntervalId = null;
        }
        timerElement.textContent = '30'; // Reset the timer display
        resendOtpButton.style.display = 'none'; // Hide the resend button
    }

    submitOTP.addEventListener("click", () => {
        const otpInputs = document.querySelectorAll('.otp-input');
        const otp = Array.from(otpInputs).map(input => input.value).join('');
        if (validateOTP(otp)) {
            const adminType = JSON.parse(localStorage.getItem('adminType'));
            const userType = JSON.parse(localStorage.getItem('userEmail'));

            const currentTime = new Date().getTime();
            const COOKIE_EXPIRATION_HOURS = adminType === 'super_admin' ? 1 : 0.5; // 60 or 30 minutes based on admin type
            const expirationTime = new Date(currentTime + COOKIE_EXPIRATION_HOURS * 60 * 60 * 1000);

            localStorage.setItem('loginTime', expirationTime.toISOString());
            hideOTPModal(); // Hide the OTP modal upon successful validation
        }
    });

    closeModal.addEventListener("click", hideOTPModal);
    otpOverlay.addEventListener("click", hideOTPModal);
    // resendOtpButton.addEventListener("click",)
    // Close modal if clicking outside the modal content
    resendOtpButton.addEventListener("click", (event) => {
      postPhoneNumber()
      phoneNumber()
        if (event.target === resendOtpButton) {
          resendOtpButton.style.display = "none"
        }
    });
    const getOtpButton = document.getElementById('get-otp-btn');
  getOtpButton.addEventListener('click', function () {
      showOTPModal1();
      postPhoneNumber()
      phoneNumber()
  });
    const elements = document.querySelectorAll("button, input, select, textarea, a, li, div, th, td, span, i");
    elements.forEach(element => {
        element.addEventListener("click", (event) => {
            if (element.classList.contains("otp-exempt3")) {
                event.preventDefault();
             
                    showOTPModal();
  
            }
        });
      })
}


if( statusType == "true"){
otpAdd.classList.add('otp-exempt3')
}else{
otpAdd.classList.remove('otp-exempt3')

}


    function displayTableRows() {
    // Clear existing table rows
    $("table tbody").empty();
    var tab_start = (current_index - 1) * table_size;
    var tab_end = Math.min(current_index * table_size, array.length);

    if (array.length === 0) {
        $("#noDataFound").show();
        $("#pagination").hide();
        $("#table-scrolling").css("overflow-x", "hidden");
        return;
    } else {
        $("#noDataFound").hide();
        $("#pagination").show();
        $("#table-scrolling").css("overflow-x", "auto");
    }

    for (var i = tab_start; i < tab_end; i++) {
        var object = array[i];
        var tr = $("<tr></tr>");

        // Populate table cells with match data
        var noCell = $("<td></td>").text(i + 1);
        var teamNameCell = $("<td colspan='3'></td>").text(object.match_display_name);
        var totalPoolCell = $("<td colspan='2'></td>").text("Your Total Pool");
        var fantacyStartCell = $("<td colspan='2'></td>").text(object.match_start_date);
        var fantacyEndCell = $("<td colspan='2'></td>").text(object.match_end_date);
        var totalAmountCell = $("<td colspan='3'></td>").text("Your Total Amount");
        var totalPlayersCell = $("<td></td>").text(object.select_player_A.length + object.select_player_B.length);
        var statusCell = $("<td colspan='2'></td>").text(getStatus(object.match_start_date, object.match_end_date));
        console.log(statusCell)

        if(statusType == "true"){
          var viewCell = $("<td class='otp-exempt3'></td>").html(
            '<span class="sortable otp-exempt3" onclick="handleView(' + object["id"] +')"><i class="far fa-eye otp-exempt3"></i></span>'
        );
        var editCell = $("<td class='otp-exempt3'></td>").html(
            '<span class="sortable otp-exempt3" onclick="handleEdit(' + object["id"] + ')"><i class="far fa-edit otp-exempt3"></i></span>'
        );
        var deleteCell = $("<td class='otp-exempt3'></td>").html(
            '<span class="sortable otp-exempt3" onclick="handleDelete(' + object["id"] + ')"><i class="far fa-trash-alt otp-exempt3"></i></span>'
        );
        }
        else{
          var viewCell = $("<td></td>").html(
            '<span class="sortable" onclick="handleView(' + object["id"] +')"><i class="far fa-eye"></i></span>'
        );
        var editCell = $("<td></td>").html(
            '<span class="sortable" onclick="handleEdit(' + object["id"] + ')"><i class="far fa-edit"></i></span>'
        );
        var deleteCell = $("<td></td>").html(
            '<span class="sortable" onclick="handleDelete(' + object["id"] + ')"><i class="far fa-trash-alt"></i></span>'
        );
        }
        

        // Append cells to the row
        tr.append(noCell)
            .append(teamNameCell)
            .append(totalPoolCell)
            .append(fantacyStartCell)
            .append(fantacyEndCell)
            .append(totalAmountCell)
            .append(totalPlayersCell)
            .append(statusCell)
            .append(viewCell)
            .append(editCell)
            .append(deleteCell);

        // Append the row to the table body
        $("table tbody").append(tr);
    }
}

      async function handleDelete(id) {
        if( statusType == "true"){      

initializePage1()

}else{
        if(confirm("Are you sure you want to delete this match?")){

          const url = `https://krinik.pythonanywhere.com/match_get/${id}/`;
          try {
              const response = await fetch(url, {
                  method: "DELETE",
              });
  
              if (response.ok) {
                  // Fetch the updated list of leagues after deletion
                  await fetchData();
              } else {
                  console.error("Failed to delete the league");
              }
          } catch (error) {
              console.error("Error deleting data:", error);
          }
        }

      }
    }

      async function handleView(id) {
        if( statusType == "true"){      

initializePage1()

}else{
      const url = `https://krinik.pythonanywhere.com/match_get/${id}/`;
      try {
        const response = await fetch(url);

        if (response.ok) {
          window.location.href = `view-match-details.html?id=${id}`;
        } else {
          console.error("Failed to fetch the league data");
        }
      } catch (error) {
        console.error("Error fetching data:", error);
      }
    }
  }
  
      async function handleEdit(id) {
        if( statusType == "true"){      

initializePage1()

}else{
      const url = `https://krinik.pythonanywhere.com/match_get/${id}/`;
      try {
        const response = await fetch(url);

        if (response.ok) {
          window.location.href = `edit-match.html?id=${id}`;
        } else {
          console.error("Failed to fetch the league data");
        }
      } catch (error) {
        console.error("Error fetching data:", error);
      }
    }
  }

    function prev() {
      if (current_index > 1) {
        current_index--;
        displayIndexButtons();
        // Add logic to display the previous page of items
        highlightIndexButton();
      }
    }

    function next() {
      if (current_index < max_index) {
        current_index++;
        displayIndexButtons();
        // Add logic to display the next page of items
        highlightIndexButton();
      }
    }

    function indexPagination(index) {
      current_index = index;
      displayIndexButtons();
      highlightIndexButton();
    }

    const table = document.getElementById('matchTable');
const downloadBtn = document.getElementById('download-btn');

downloadBtn.addEventListener('click', () => {
  const workbook = XLSX.utils.table_to_book(table, { sheet: 'Match Data' });
  const excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
  const data = new Blob([excelBuffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
  const url = URL.createObjectURL(data);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'match_data.xlsx';
  a.click();

  URL.revokeObjectURL(url);
  a.remove();
});


  </script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.17.4/dist/xlsx.full.min.js"></script>
  
  
      
  </body>
</html>
 