<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Add Match</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description" />
    <meta content="Themesdesign" name="author" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- App favicon -->
    <!-- <link rel="shortcut icon" href="assets/images/favicon.ico"> -->
    <link rel="icon" href="./assets/images/krinikIn_Logo.svg" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <!-- Bootstrap Css -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <!-- Icons Css -->
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css" />
    <!-- App Css-->
    <link href="assets/css/app.css" rel="stylesheet" type="text/css" />

    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,300,0,0" />
</head>

<body data-topbar="colored">

    <!-- Begin page -->
    <div id="layout-wrapper">

        <header id="page-topbar" class="">
            <div class="navbar-header ">
                <div class="d-flex ">
                    <!-- LOGO -->
                    <div class="navbar-brand-box">
                        <a href="./dashboard.html" class="logo logo-dark">
                            <span class="logo-sm">

                                <img src="./assets/images/krinikIn_Logo.svg" alt="" />
                            </span>
                            <span class="logo-lg">

                                <img src="./assets/images/krinikIn_Logo.svg" alt="" />
                            </span>
                        </a>

                        <a href="index.html" class="logo logo-light ">
                            <span class="logo-sm">

                                <img src="./assets/images/krinikIn_Logo.svg" alt="" />
                            </span>
                            <span class="logo-lg">

                                <img src="./assets/images/krinikIn_Logo.svg" alt="" />
                            </span>
                        </a>
                    </div>

                    <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect "
                        id="vertical-menu-btn">
                        <i class="mdi mdi-backburger "></i>
                    </button>

                    <!-- App Search-->
                    <!-- <form class="app-search d-none d-lg-block">
                                  <div class="position-relative mt-3">
                                      <input type="text" class="form-control" placeholder="Search...">
                                      <span class="mdi mdi-magnify"></span>
                                  </div>
                              </form> -->
                </div>

                <div class="  d-flex justify-content-center gap-4 time_show1">
                    <div class="dropdown d-flex justify-content-end ms-2  " id="enterotpdiv">
                        <!-- <button id="showotppage" type="button" class="btn btn-primary2  waves-effect" 
                   >Enter OTP
                  </button> -->

                    </div>

                    <div class="dropdown   dblock">
                        <div id="time_show" class="btn-primary2  px-3">
                        </div>
                    </div>


                </div>

            </div>
        </header>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu ">
            <div data-simplebar class="h-100 ">
              <!--- Sidemenu -->
              <div id="sidebar-menu" class="">
                <!-- Left Menu Start -->
                <ul class="metismenu list-unstyled " id="side-menu">
                  <li class="menu-title">Menu</li>
      
                  <li>
                    <a href="./dashboard.html" class="waves-effect">
                      <div class=" icons-sm icon-set">
                        <span class="material-symbols-outlined icon-margin">
                          dashboard
                          </span>
                     
                      <span>Dashboard</span>
                      </div>
                    </a>
                  </li>
      
                  <li>
                    <a href="./user.html" class="waves-effect">
                      <div class="icons-sm icon-set">
                        <span class="material-symbols-outlined icon-margin">
                          person
                          </span>
                     
                      <span>User</span>
                    </div>
                    </a>
                  </li>
      
                  <li>
                    <a href="javascript: void(0);" class=" ">
                      <div class="icons-sm icon-set ">
                        <span class="material-symbols-outlined icon-margin">
                          sports_cricket
                          </span>                    
                          <span class="has-arrow waves-effect ">Sports Configuration</span>
                                          
                        </div> 
                        
                      </a>
      
                    <ul class="sub-menu" aria-expanded="false">
                      <li><a href="./manage-league.html">Manage Leagues</a></li>
                      <li><a href="./manage-team.html">Manage Teams</a></li>
                      <li><a href="./manage-player.html">Manage Players</a></li>
                    </ul>
                  </li>
                  
                  <li>
                    <a href="javascript: void(0);" class=" ">
                      <div class="icons-sm icon-set ">
                        <span class="material-symbols-outlined icon-margin">
                          crossword
                          </span>                   
                          <span class="has-arrow has-arrow1 waves-effect ">Manage Contest</span>
                                          
                        </div> 
                        
                      </a>
      
                    <ul class="sub-menu" aria-expanded="false">
                      <li><a href="./manage-match.html">Manage Match</a></li>
                      <li><a href="./manage-pool.html">Manage Pools</a></li>
                    </ul>
                  </li>
      
                  <li class="otp-exempt" style="display:none">
                    <a href="javascript: void(0);" class=" ">
                      <div class="icons-sm icon-set ">
                        <span class="material-symbols-outlined icon-margin">
                          receipt_long
                          </span>                 
                          <span class="has-arrow has-arrow2 waves-effect ">Transactions</span>
                                          
                        </div> 
                        
                      </a>
      
                    <ul class="sub-menu" aria-expanded="false">
                      <li><a href="./all-transaction.html">All Transaction</a></li>
                      <li><a href="./wallet-transaction.html">Wallet Transaction</a></li>
                      <li><a href="./game-transaction.html">Game Transaction</a></li>
                    </ul>
                  </li>
      
                  <li class="otp-exempt" style="display:none">
                    <a href="./account-setting.html" class="waves-effect">
                      <div class="icons-sm icon-set ">
                        <span class="material-symbols-outlined icon-margin">
                          settings
                          </span>
                          <span>Account Setting</span>
                      </div>
                    </a>
                  </li>
                  <li class="otp-exempt" style="display:none">
                    <a href="./advertise.html" class="waves-effect">
                      <div class="icons-sm icon-set ">
                        <span class="material-symbols-outlined icon-margin">
                          ad
                          </span>
                          <span>Advertise</span>
                      </div>
                    </a>
                  </li>
                  <li>
                    <a href="./kyc.html" class="waves-effect">
                      <div class="icons-sm icon-set">
                        <span class="material-symbols-outlined icon-margin">
                          person
                          </span>
                     
                      <span>KYC</span>
                    </div>
                    </a>
                  </li>
      
                  <li>
                    <a href="" class="waves-effect " id="logoutButton">
                      <div class=" icons-sm icon-set ">
                        <span class="material-symbols-outlined icon-margin ">
                          logout
                          </span>
                          <span class="">Logout</span>
                      </div>
                    </a>
                  </li>
      
                
                          </ul>
              </div>
              <!-- Sidebar -->
            </div>
          </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">

                <!-- Page-Title -->
                <div class="page-title-box">
                    <div class="container-fluid">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h4 class="page-title mb-1">Add Match</h4>

                            </div>

                        </div>

                    </div>
                </div>
                <!-- end page title end breadcrumb -->

                <div class="page-content-wrapper">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <form id="match-form">
                                            <div class="form-group mb-3 row mb-0">
                                                <div class="col-md-12">
                                                    <select class="form-select" aria-label="Default select example"
                                                        id="league-name">
                                                        <option selected>Select League</option>
                                                        <!-- Options will be populated dynamically -->
                                                    </select>
                                                    <span id="error-league-name" class="error-message"
                                                        style="display: none;"></span>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="team-A">
                                                        <div class="form-group mb-3">
                                                            <select class="form-select"
                                                                aria-label="Default select example" id="team-A">
                                                                <option value="" selected>Select Team A</option>
                                                                <!-- Options will be populated dynamically -->
                                                            </select>
                                                            <span id="error-team-A" class="error-message"
                                                                style="display: none;"></span>
                                                        </div>
                                                        <div class="border-2 border p-3 mb-3">
                                                            <div class="form-group mb-3">
                                                                <div class="dropdown1">
                                                                    <button type="button" class="dropbtn1 form-select"
                                                                        id="select-player-A"
                                                                        aria-label="Default select example">Select
                                                                        Multiple Players
                                                                    </button>
                                                                    <div class="dropdown-content"
                                                                        id="dropdown-players-A" style="display: none;">
                                                                        <input type="text" placeholder="Search Player"
                                                                            class="form-control" id="search-player-A">
                                                                        <i>
                                                                            <bi bi-magnifying></bi>
                                                                        </i>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="form-group mb-3">
                                                                <div class="row" id="selected-players-A">
                                                                    <!-- Selected players will appear here dynamically -->
                                                                </div>
                                                                <span id="error-players-A" class="error-message"
                                                                    style="display: none;"></span>
                                                                <span id="error-dropdown-players-A"
                                                                    style="color: red; display: none;"></span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="team-B">
                                                        <div class="form-group mb-3">
                                                            <select class="form-select"
                                                                aria-label="Default select example" id="team-B">
                                                                <option value="" selected>Select Team B</option>
                                                                <!-- Options will be populated dynamically -->
                                                            </select>
                                                            <span id="error-team-B" class="error-message"
                                                                style="display: none;"></span>
                                                        </div>
                                                        <div class="border-2 border p-3 mb-3">
                                                            <div class="form-group mb-3">
                                                                <div class="dropdown2">
                                                                    <button type="button" class="dropbtn2 form-select"
                                                                        id="select-player-B"
                                                                        aria-label="Default select example">Select
                                                                        Multiple Players
                                                                    </button>
                                                                    <div class="dropdown-content"
                                                                        id="dropdown-players-B" style="display: none;">
                                                                        <input type="text" placeholder="Search Player"
                                                                            class="form-control" id="search-player-B">
                                                                        <i>
                                                                            <bi bi-magnifying></bi>
                                                                        </i>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="form-group mb-3">
                                                                <div class="row" id="selected-players-B">
                                                                    <!-- Selected players will appear here dynamically -->
                                                                </div>
                                                                <span id="error-players-B" class="error-message"
                                                                    style="display: none;"></span>
                                                                <span id="error-dropdown-players-B"
                                                                    style="color: red; display: none;"></span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group form-group-custom mb-4">
                                                <div class="datepicker-wrapper">
                                                    <input class="form-control" type="text" name="match_start_date"
                                                        id="match-start-date" placeholder="Start Match Date">
                                                    <i id="calendarIconEnd" class="fas fa-calendar-alt date-icon2"></i>
                                                </div>
                                                <span id="error-match-start-date" class="error-message"
                                                    style="display: none;"></span>
                                            </div>
                                            <!-- <div class="form-group form-group-custom mb-4">
                                                <div class="datepicker-wrapper">
                                                    <input class="form-control" type="text" name="match_end_date"
                                                        id="match-end-date" placeholder="End Match Date">
                                                    <i id="calendarIconStart" class="fas fa-calendar-alt date-icon"></i>
                                                </div>
                                                <span id="error-match-end-date" class="error-message"
                                                    style="display: none;"></span>
                                            </div> -->
                                            <div class="mt-4 text-center d-flex justify-content-center gap-5">
                                                <button class="btn btn-primary" type="submit"
                                                    id="submit-button">Submit</button>
                                                <button class="btn btn-primary grey-btn" type="button" id="cancel-btn"
                                                    onclick="window.location.replace('./manage-match.html')">Cancel</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <!-- end col -->
    </div>
    <!-- end row -->



    </div>
    <!-- end container-fluid -->
    </div>
    <!-- end page-content-wrapper -->
    </div>
    <!-- End Page-content -->


    <footer class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    2024 Â© Krinik.
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end d-none d-sm-block">
                        Crafted with <i class="mdi mdi-heart text-danger"></i> by Themesdesign
                    </div>
                </div>
            </div>
        </div>
    </footer>
    </div>
    <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->


    <script src="./assets/js/logout.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>

    <!-- JAVASCRIPT -->
    <script src="assets/libs/jquery/jquery.min.js"></script>
    <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/libs/metismenu/metisMenu.min.js"></script>
    <script src="assets/libs/simplebar/simplebar.min.js"></script>
    <script src="assets/libs/node-waves/waves.min.js"></script>

    <script src="https://unicons.iconscout.com/release/v2.0.1/script/monochrome/bundle.js"></script>
    <!--  -->
    <!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="assets/js/app.js"></script>

    <script>

        document.addEventListener('DOMContentLoaded', async function () {

            // let leagueName1 = document.getElementById('league-name').value

            $(function () {
    let startPicker = flatpickr('#match-start-date', {
        dateFormat: 'd-m-Y H:i',
        enableTime: true,
        minDate: 'today', // Disable past dates
        onChange: function (selectedDates, dateStr, instance) {
            if (selectedDates.length > 0) {
                // No endPicker, so no need to set minDate for another picker.
            }
        },
        onReady: function (selectedDates, dateStr, instance) {
            addCustomButtons(instance, '#match-start-date');
        }
    });

    // Open Flatpickr on calendar icon click
    $('#calendarIconStart').click(function () {
        startPicker.open();
    });

    let okButtonClicked = false;

    function addCustomButtons(instance, inputSelector) {
        // Ensure the calendarContainer is available
        if (!instance || !instance.calendarContainer) {
            console.error('Flatpickr instance or calendar container not found.');
            return;
        }

        // Check if the footer already exists and remove it
        let existingFooter = instance.calendarContainer.querySelector('.flatpickr-footer');
        if (existingFooter) {
            existingFooter.remove();
        }

        // Create footer and buttons
        const footer = document.createElement('div');
        footer.className = 'flatpickr-footer';

        const okButton = document.createElement('button');
        okButton.type = 'button';
        okButton.className = 'flatpickr-ok-button';
        okButton.textContent = 'OK';
        okButton.addEventListener('click', function () {
            okButtonClicked = true;
            instance.close(); // Close the picker
        });

        const clearButton = document.createElement('button');
        clearButton.type = 'button';
        clearButton.className = 'flatpickr-clear-button';
        clearButton.textContent = 'Clear';
        clearButton.addEventListener('click', function () {
            document.querySelector(inputSelector).value = ''; // Clear input value
            instance.clear(); // Clear picker
        });

        footer.appendChild(okButton);
        footer.appendChild(clearButton);

        // Append the footer to the calendar container
        instance.calendarContainer.appendChild(footer);
    }

    // Modify the onChange event handler to only update the input value when the OK button is clicked
    startPicker.config.onChange = function (selectedDates, dateStr, instance) {
        if (okButtonClicked) {
            document.querySelector('#match-start-date').value = dateStr;
            okButtonClicked = false; // Reset the flag
        }
    };
});

            //             function initializeDatePickers(leaguedata) {
            //     const leagueName1 = document.getElementById('league-name');
            //     const matchDisplayName = leagueName1.value; // Get the selected match display name
            // console.log(matchDisplayName,"oki")
            //     // Find the league data based on the selected league
            //     let findmatch = leaguedata.find((p) => p.league_name === matchDisplayName);
            //     if (!findmatch) {
            //         console.error('No matching league found.');
            //         return;
            //     }

            //     let startleagueDate = findmatch.start_league_date;
            //     let endleagueDate = findmatch.end_league_date;

            // Initialize the start date picker
            // const startPicker = flatpickr('#fantasyStartDate', {
            //     dateFormat: 'd-m-Y H:i',
            //     enableTime: true,
            //     minDate: startleagueDate, // Set the minimum date from the league data
            //     maxDate: endleagueDate, // Set the maximum date to the end league date
            //     onReady: function (selectedDates, dateStr, instance) {
            //         addCustomButtons(instance, '#fantasyStartDate');
            //     }
            // });
            //     let startPicker = flatpickr('#match-start-date', {
            //                     dateFormat: 'd-m-Y H:i',
            //                     enableTime: true,
            //                     minDate: 'startleagueDate', // Disable past dates
            //                     onChange: function (selectedDates, dateStr, instance) {
            //                         if (selectedDates.length > 0) {
            //                             endPicker.set('minDate', selectedDates[0]);
            //                             // Close the picker if both date and time are selected
            //                             // if (dateStr.includes(' ')) {
            //                             //     instance.close(); // Close the picker after full date-time selection
            //                             // }
            //                         }
            //                     },
            //                     onReady: function (selectedDates, dateStr, instance) {
            //                         addCustomButtons(instance, '#match-start-date');
            //                     }
            //                 });


            //                 let endPicker = flatpickr('#match-end-date', {
            //                     dateFormat: 'd-m-Y H:i',
            //                     enableTime: true,
            //                     onOpen: function () {
            //                         const startDate = startPicker.selectedDates[0];
            //                         if (startDate) {
            //                             endPicker.set('minDate', startDate);
            //                         }
            //                     },
            //                     onChange: function (selectedDates, dateStr, instance) {
            //                         if (selectedDates.length > 0) {
            //                             // Close the picker if both date and time are selected
            //                             // if (dateStr && dateStr.includes(' ')) {
            //                             //     instance.close(); // Close the picker after full date-time selection
            //                             // }
            //                         }
            //                     },
            //                     onReady: function (selectedDates, dateStr, instance) {
            //                         addCustomButtons(instance, '#match-end-date');
            //                     }
            //                 });

            //                 // Open Flatpickr on calendar icon click
            //                 $('#calendarIconStart').click(function () {
            //                     startPicker.open();
            //                 });
            //                 $('#calendarIconEnd').click(function () {
            //                     endPicker.open();
            //                 });
            //                 let okButtonClicked = false;

            //     // Add custom buttons to the picker
            //     function addCustomButtons(instance, inputSelector) {
            //         if (!instance || !instance.calendarContainer) {
            //             console.error('Flatpickr instance or calendar container not found.');
            //             return;
            //         }

            //         let existingFooter = instance.calendarContainer.querySelector('.flatpickr-footer');
            //         if (existingFooter) {
            //             existingFooter.remove();
            //         }

            //         const footer = document.createElement('div');
            //         footer.className = 'flatpickr-footer';

            //         const okButton = document.createElement('button');
            //         okButton.type = 'button';
            //         okButton.className = 'flatpickr-ok-button';
            //         okButton.textContent = 'OK';
            //         okButton.addEventListener('click', function () {
            //             instance.close();
            //         });

            //         const clearButton = document.createElement('button');
            //         clearButton.type = 'button';
            //         clearButton.className = 'flatpickr-clear-button';
            //         clearButton.textContent = 'Clear';
            //         clearButton.addEventListener('click', function () {
            //             document.querySelector(inputSelector).value = '';
            //             instance.clear();
            //         });

            //         footer.appendChild(okButton);
            //         footer.appendChild(clearButton);

            //         instance.calendarContainer.appendChild(footer);
            //     }
            // }


            // document.getElementById('league-name').addEventListener('change', function () {
            //     const matchDisplayName = this.value;
            //     // console.log(leaguedata,"datata")
            //     const findmatch = leaguedata.data.find((p) => p.league_name === matchDisplayName);
            //     console.log(findmatch,"find")
            //     if (!findmatch) {
            //         console.error('No matching league found.');
            //         return;
            //     }
            //     const matchStartDate = findmatch.end_league_date;
            //     const matchEndDate = findmatch.end_league_date; // Get the match end date from the data

            //     // Update Flatpickr configurations
            //     flatpickr('#fantasyStartDate', {
            //         dateFormat: 'd-m-Y H:i',
            //         enableTime: true,
            //         minDate: 'today',
            //         maxDate: matchEndDate,
            //     });

            //     document.getElementById('fantasyStartDate').value = '';
            // });

            // for (const obj of existingMatches) {
            //     console.log(obj.match_start_date);
            // }
            // console.log(existingMatches[0].match_start_date, "okkk");

            let arr = [];
            console.log(arr)
            let teams = [];
            let allPlayers = {
                'dropdown-players-A': [],
                'dropdown-players-B': []
            };

            let leaguedata

            // function populateSelect(selectElement, data, key, defaultOptionText, exclude = "") {
            //     selectElement.innerHTML = '';
            //     const defaultOption = document.createElement('option');
            //     defaultOption.value = '';
            //     defaultOption.textContent = defaultOptionText;
            //     selectElement.appendChild(defaultOption);

            //     data.forEach(item => {
            //         if (item[key] !== exclude) {
            //             const option = document.createElement('option');
            //             option.value = item[key];
            //             option.textContent = item[key];
            //             selectElement.appendChild(option);
            //         }
            //     });
            // }
            function populateSelect(selectElement, data, key, defaultOptionText, exclude = "") {
                selectElement.innerHTML = '';
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = defaultOptionText;
                selectElement.appendChild(defaultOption);

                data.forEach(item => {
                    if (item[key] !== exclude) {
                        const option = document.createElement('option');
                        option.value = item[key];
                        option.textContent = item[key];
                        selectElement.appendChild(option);
                    }
                });

                // Re-enable the select if it was disabled
                selectElement.disabled = false;
            }
            function populateSelect1(data) {
                const selectElement = document.getElementById('league-name');
                selectElement.innerHTML = '<option value="">Select League</option>';
                const currentDate1 = new Date();
                const currentDate = (moment(currentDate1, 'YYYY-MM-DD').format('DD-MM-YYYY')) // Get the current date and time
                console.log(currentDate)
                // console.log(data[2].end_league_date)
                data.forEach(league => {
                    const leagueEndDate = league.end_league_date;  // Convert start_league_date to a Date object

                    // Only add the league to the dropdown if it hasn't expired (currentDate is before leagueStartDate)
                    if (currentDate < leagueEndDate) {
                        const option = document.createElement('option');
                        option.value = league.league_name;
                        option.textContent = league.league_name;
                        selectElement.appendChild(option);
                    }
                });
            }


            async function fetchLeagues() {
                try {
                    const response = await fetch('https://krinik.pythonanywhere.com/league_get/');
                    if (!response.ok) throw new Error('Failed to fetch leagues');
                    leaguedata = await response.json();
                    if (leaguedata.status === 'success' && Array.isArray(leaguedata.data)) {
                        console.log(leaguedata.data, "leafuedata1")
                        populateSelect1(leaguedata.data);

                        // initializeDatePickers(leaguedata.data);
                        document.getElementById('league-name').addEventListener('change', function () {
                            const leagueName = this.value;
                            fetchTeams(leagueName);
                            clearAllSelectedPlayers();


                            document.getElementById('team-A').value = '';
                            document.getElementById('team-B').value = '';

                        });
                    } else {
                        console.error('Invalid data format for leagues:', data);
                    }
                } catch (error) {
                    console.error('Error fetching leagues:', error);
                }
            }
            async function fetchTeams(leagueName) {
                try {
                    const response = await fetch(`https://krinik.pythonanywhere.com/team_get/`);
                    if (!response.ok) throw new Error('Failed to fetch teams');
                    const data = await response.json();
                    if (data.status === 'success' && Array.isArray(data.data)) {
                        teams = data.data.filter(team => team.league_name === leagueName);
                        updateTeamSelects();

                    } else {
                        console.error('Invalid data format for teams:', data);
                    }
                } catch (error) {
                    console.error('Error fetching teams:', error);
                }
            }
            updatePlayerSelectionEnabled();

            // function updateTeamSelects() {
            //     const teamASelected = document.getElementById('team-A').value;
            //     const teamBSelected = document.getElementById('team-B').value;
            //     const leagueSelected = document.getElementById('league-name').value;
            //     if(teams.length > 0){

            //                         populateSelect(document.getElementById('team-A'), teams, 'team_name', 'Select Team A', teamBSelected);
            //                         populateSelect(document.getElementById('team-B'), teams, 'team_name', 'Select Team B', teamASelected);

            //     }else{
            //         document.getElementById('error-team-A').innerHTML = 'Team-A name already exists';
            //                 document.getElementById('error-team-A').style.display = 'inline';
            //                 document.getElementById('error-team-B').innerHTML = 'Team-B name already exists';
            //                 document.getElementById('error-team-B').style.display = 'inline'; 
            //     }

            //     document.getElementById('team-A').value = teamASelected;
            //     document.getElementById('team-B').value = teamBSelected;
            //     updatePlayerSelectionEnabled();


            // }


            function updateTeamSelects() {
                const teamASelected = document.getElementById('team-A').value;
                const teamBSelected = document.getElementById('team-B').value;

                if (teams.length === 0) {
                    // No teams available
                    document.getElementById('error-team-A').innerHTML = 'Create team first';
                    document.getElementById('error-team-A').style.display = 'inline';
                    document.getElementById('error-team-B').innerHTML = 'Create team first';
                    document.getElementById('error-team-B').style.display = 'inline';
                    document.getElementById('error-dropdown-players-A').style.display = 'none';
                    document.getElementById('error-dropdown-players-B').style.display = 'none';
                    // Disable both dropdowns
                    document.getElementById('team-A').disabled = true;
                    document.getElementById('team-B').disabled = true;
                } else if (teams.length === 1) {
                    // Only one team available
                    // Populate team-A dropdown and show error for team-B
                    populateSelect(document.getElementById('team-A'), teams, 'team_name', 'Select Team A', teamBSelected);
                    document.getElementById('error-team-A').style.display = 'none'; // Hide error for team-A
                    document.getElementById('error-team-B').innerHTML = 'Only one team available. Please create another team.';
                    document.getElementById('error-team-B').style.display = 'inline';
                    // Disable team-B dropdown
                    document.getElementById('team-B').disabled = true;

                } else {
                    // showPlayerError(dropdownId, 'No players available for this team.');


                    // At least two teams available
                    // Populate both dropdowns
                    populateSelect(document.getElementById('team-A'), teams, 'team_name', 'Select Team A', teamBSelected);
                    populateSelect(document.getElementById('team-B'), teams, 'team_name', 'Select Team B', teamASelected);

                    // Hide errors and enable both dropdowns
                    document.getElementById('error-team-A').style.display = 'none';
                    document.getElementById('error-team-B').style.display = 'none';
                    document.getElementById('error-dropdown-players-A').style.display = 'none';
                    document.getElementById('error-dropdown-players-B').style.display = 'none';
                    document.getElementById('team-A').disabled = false;
                    document.getElementById('team-B').disabled = false;
                }

                // Re-assign previous selections if available
                document.getElementById('team-A').value = teamASelected;
                document.getElementById('team-B').value = teamBSelected;

                // Re-enable player selection logic
                updatePlayerSelectionEnabled();
            }

            //     async function fetchPlayers(teamName, dropdownId,leagueSelected) {
            //         try {
            //             const response = await fetch('https://krinik.pythonanywhere.com/player_get/');
            //             if (!response.ok) throw new Error('Failed to fetch players');
            //             const data = await response.json();
            //             console.log(leagueSelected,"leagueSelected")
            //             if (data.status === 'success' && Array.isArray(data.data)) {
            //                 const players = data.data.filter(player => player.team_name === teamName && player.league_name === leagueSelected );
            //                 allPlayers[dropdownId] = players;

            //                 populatePlayerDropdown(players, dropdownId);
            //             } else {
            //                 console.error('Invalid data format for players:', data);
            //             }
            //         } catch (error) {
            //             console.error('Error fetching players:', error);
            //         }
            //     }

            //     function populatePlayerDropdown(players, dropdownId) {
            //         const dropdown = document.getElementById(dropdownId);
            //         dropdown.innerHTML = '';

            //         const searchInput = document.createElement('input');
            //         searchInput.type = 'text';
            //         searchInput.placeholder = 'Search players...';
            //         searchInput.className = 'search-input';
            //         searchInput.addEventListener('input', function (event) {
            //             filterPlayers(event.target.value, dropdownId);
            //         });
            //         dropdown.appendChild(searchInput);

            //         const playerContainer = document.createElement('div');
            //         playerContainer.className = 'player-container';

            //         players.forEach((player, index) => {
            //             if (index < 6) {
            //                 const playerOption = document.createElement('a');
            //                 playerOption.href = '#';
            //                 playerOption.className = 'player-option';
            //                 playerOption.dataset.id = player.id;
            //                 playerOption.textContent = player.player_name;
            //                 playerOption.addEventListener('click', function (event) {
            //                     event.preventDefault();
            //                     const playerId = player.id;
            //                     // console.log(playerId)
            //                     const playerName = player.player_name;
            //                     const selectedPlayersDiv = dropdownId === 'dropdown-players-A' ? 'selected-players-A' : 'selected-players-B';
            //                     filterPlayers(playerId, dropdownId);
            //                     if (!document.querySelector(`#${selectedPlayersDiv} .player-option[data-id="${playerId}"]`)) {
            //                         document.getElementById(selectedPlayersDiv).insertAdjacentHTML('beforeend', `
            //     <div class="col-md-6 d-flex align-items-center justify-content-between player-wrapper">
            //       <p class="form-control p-3 d-flex align-content-center justify-content-between player-option" data-id="${playerId}">
            //         ${playerName} <span class="remove-player" data-id="${playerId}"><i class="bi bi-x"></i></span>
            //       </p>
            //     </div>
            //   `);
            //                     }
            //                     // Remove the selected player from the dropdown list
            //                     playerOption.remove();
            //                     dropdown.style.display = 'none';
            //                 });
            //                 playerContainer.appendChild(playerOption);
            //             }
            //         });

            //         if (players.length > 6) {
            //             playerContainer.style.maxHeight = '200px';
            //             playerContainer.style.overflowY = 'auto';
            //         }


            //         dropdown.appendChild(playerContainer);

            //         dropdown.addEventListener('click', function (event) {
            //             if (event.target.classList.contains('player-option')) {
            //                 event.preventDefault();
            //                 const playerId = event.target.dataset.id;
            //                 const playerName = event.target.textContent;
            //                 const selectedPlayersDiv = dropdownId === 'dropdown-players-A' ? 'selected-players-A' : 'selected-players-B';

            //                 if (!document.querySelector(`#${selectedPlayersDiv} .player-option[data-id="${playerId}"]`)) {
            //                     document.getElementById(selectedPlayersDiv).insertAdjacentHTML('beforeend', `
            //                     <div class="col-md-6 d-flex align-items-center justify-content-between player-wrapper">
            //                         <p class="form-control p-3 d-flex align-content-center justify-content-between player-option" data-id="${playerId}">
            //                             ${playerName} <span class="remove-player" data-id="${playerId}"><i class="bi bi-x"></i></span>
            //                         </p>
            //                     </div>
            //                 `);
            //                 }

            //                 dropdown.style.display = 'none';
            //             }
            //         });
            //     }

            async function fetchPlayers(teamName, dropdownId, leagueSelected) {
                try {
                    const response = await fetch('https://krinik.pythonanywhere.com/player_get/');
                    if (!response.ok) throw new Error('Failed to fetch players');
                    const data = await response.json();
                    console.log(leagueSelected, "leagueSelected");
                    if (data.status === 'success' && Array.isArray(data.data)) {
                        const players = data.data.filter(player => player.team_name.team_name === teamName && player.league_name === leagueSelected);
                        allPlayers[dropdownId] = players;

                        if (players.length === 0) {
                            // No players for this team, show an error and disable the dropdown
                            showPlayerError(dropdownId, 'No players available for this team.');
                        } else {
                            // Populate normally if there are multiple players
                            populatePlayerDropdown(players, dropdownId);

                            hidePlayerError(dropdownId);
                        }
                    } else {
                        console.error('Invalid data format for players:', data);
                    }
                } catch (error) {
                    console.error('Error fetching players:', error);
                }
            }

            function populatePlayerDropdown(players, dropdownId) {
                const dropdown = document.getElementById(dropdownId);
                dropdown.innerHTML = '';

                const searchInput = document.createElement('input');
                searchInput.type = 'text';
                searchInput.placeholder = 'Search players...';
                searchInput.className = 'search-input';
                searchInput.addEventListener('input', function (event) {
                    filterPlayers(event.target.value, dropdownId);
                });
                dropdown.appendChild(searchInput);

                const playerContainer = document.createElement('div');
                playerContainer.className = 'player-container';

                players.forEach((player, index) => {
                    if (index < 6) {
                        const playerOption = document.createElement('a');
                        playerOption.href = '#';
                        playerOption.className = 'player-option';
                        playerOption.dataset.id = player.id;
                        playerOption.textContent = player.player_name;
                        playerOption.addEventListener('click', function (event) {
                            event.preventDefault();
                            const playerId = player.id;
                            const playerName = player.player_name;
                            const selectedPlayersDiv = dropdownId === 'dropdown-players-A' ? 'selected-players-A' : 'selected-players-B';

                            if (!document.querySelector(`#${selectedPlayersDiv} .player-option[data-id="${playerId}"]`)) {
                                document.getElementById(selectedPlayersDiv).insertAdjacentHTML('beforeend', `
                        <div class="col-md-6 d-flex align-items-center justify-content-between player-wrapper">
                          <p class="form-control p-3 d-flex align-content-center justify-content-between player-option" data-id="${playerId}">
                            ${playerName} <span class="remove-player" data-id="${playerId}"><i class="bi bi-x"></i></span>
                          </p>
                        </div>
                    `);
                            }

                            // Check if the player ID is already in the array
                            if (!arr.includes(playerId)) {
                                arr.push(playerId); // Push player ID into the array when added
                            }

                            console.log(arr, "arrr");

                            playerOption.remove(); // Remove the selected player from the dropdown list
                            dropdown.style.display = 'none';
                        });
                        playerContainer.appendChild(playerOption);
                    }
                });

                if (players.length > 6) {
                    playerContainer.style.maxHeight = '200px';
                    playerContainer.style.overflowY = 'auto';
                }

                dropdown.appendChild(playerContainer);

                dropdown.addEventListener('click', function (event) {
                    if (event.target.classList.contains('player-option')) {
                        event.preventDefault();
                        const playerId = event.target.dataset.id;
                        const playerName = event.target.textContent;
                        const selectedPlayersDiv = dropdownId === 'dropdown-players-A' ? 'selected-players-A' : 'selected-players-B';

                        if (!document.querySelector(`#${selectedPlayersDiv} .player-option[data-id="${playerId}"]`)) {
                            document.getElementById(selectedPlayersDiv).insertAdjacentHTML('beforeend', `
                    <div class="col-md-6 d-flex align-items-center justify-content-between player-wrapper">
                        <p class="form-control p-3 d-flex align-content-center justify-content-between player-option" data-id="${playerId}">
                            ${playerName} <span class="remove-player" data-id="${playerId}"><i class="bi bi-x"></i></span>
                        </p>
                    </div>
                `);
                        }

                        // Check if the player ID is already in the array
                        if (!arr.includes(playerId)) {
                            arr.push(playerId); // Push player ID into the array when added
                        }

                        console.log(arr, "arrr");

                        dropdown.style.display = 'none';
                    }
                });
            }


            function showPlayerError(dropdownId, message) {
                const errorElement = document.getElementById(`error-${dropdownId}`);
                errorElement.innerHTML = message;
                errorElement.style.display = 'inline';
                document.getElementById(dropdownId).disabled = true;
            }

            function hidePlayerError(dropdownId) {
                const errorElement = document.getElementById(`error-${dropdownId}`);
                errorElement.style.display = 'none';
                document.getElementById(dropdownId).disabled = false;
            }


            function filterPlayers(searchText, dropdownId) {
                const dropdown = document.getElementById(dropdownId);
                const players = allPlayers[dropdownId];
                const selectedPlayers = Array.from(document.querySelectorAll(`#${dropdownId === 'dropdown-players-A' ? 'selected-players-A' : 'selected-players-B'} .player-option`)).map(player => player.dataset.id);
                const filteredPlayers = players.filter(player => !selectedPlayers.includes(player.id) && player.player_name.toLowerCase().includes(searchText.toLowerCase()));

                dropdown.innerHTML = '';

                const searchInput = document.createElement('input');
                searchInput.type = 'text';
                searchInput.placeholder = 'Search players...';
                searchInput.className = 'search-input';
                searchInput.value = searchText;
                searchInput.addEventListener('input', function (event) {
                    filterPlayers(event.target.value, dropdownId);
                });
                dropdown.appendChild(searchInput);
                searchInput.focus(); // Keep the input field focused

                filteredPlayers.forEach(player => {
                    const playerOption = document.createElement('a');
                    playerOption.href = '#';
                    playerOption.className = 'player-option';
                    playerOption.dataset.id = player.id;
                    playerOption.textContent = player.player_name;
                    dropdown.appendChild(playerOption);
                });
            }

            function clearAllSelectedPlayers() {
                document.getElementById('selected-players-A').innerHTML = '';
                document.getElementById('selected-players-B').innerHTML = '';
            }

            function clearSelectedPlayers(teamId) {
                if (teamId === 'team-A') {
                    document.getElementById('selected-players-A').innerHTML = '';
                } else if (teamId === 'team-B') {
                    document.getElementById('selected-players-B').innerHTML = '';
                }
            }

            function updatePlayerSelectionEnabled() {
                const leagueSelected = document.getElementById('league-name').value;
                const teamASelected = document.getElementById('team-A').value;
                const teamBSelected = document.getElementById('team-B').value;

                if (leagueSelected && teamASelected) {
                    fetchPlayers(teamASelected, 'dropdown-players-A', leagueSelected);
                    document.getElementById('select-player-A').disabled = false;
                } else {
                    document.getElementById('select-player-A').disabled = true;
                }

                if (leagueSelected && teamBSelected) {
                    fetchPlayers(teamBSelected, 'dropdown-players-B', leagueSelected);
                    document.getElementById('select-player-B').disabled = false;

                } else {
                    document.getElementById('select-player-B').disabled = true;

                }
            }

            document.addEventListener('click', function (event) {
                if (event.target.classList.contains('remove-player') || event.target.closest('.remove-player')) {
                    const parentDiv = event.target.closest('.player-wrapper');
                    const playerId = event.target.dataset.id || event.target.closest('.remove-player').dataset.id;
                    parentDiv.remove();
                    arr = arr.filter(id => id !== playerId);
                    console.log(arr, "ploplo")
                }

                const dropdownA = document.getElementById('dropdown-players-A');
                const dropdownB = document.getElementById('dropdown-players-B');

                if (!event.target.closest('#dropdown-players-A') && !event.target.closest('#select-player-A')) {
                    dropdownA.style.display = 'none';
                }

                if (!event.target.closest('#dropdown-players-B') && !event.target.closest('#select-player-B')) {
                    dropdownB.style.display = 'none';
                }
            });
            document.getElementById('team-A').addEventListener('change', function () {
                clearSelectedPlayers('team-A');
                updateTeamSelects();
            });

            document.getElementById('team-B').addEventListener('change', function () {
                clearSelectedPlayers('team-B');
                updateTeamSelects();
            });


            function checkOverlap(teamA, teamB, startDate1, existingMatches) {
                // console.log(leagueExist, "leagueche");
                const startDate = document.getElementById('match-start-date').value;

                if (!existingMatches || existingMatches.length === 0) {
                    return { teamAOverlap: false, teamBOverlap: false, dateOverlap: false };
                }

                // Log team names for debugging
                // const leagueOverlap = existingMatches.some(match => match.select_league.league_name === leagueExist);
                // console.log('league Overlap:', leagueOverlap);

                const teamAOverlap = existingMatches.some(match => match.select_team_A.team_name === teamA || match.select_team_B.team_name === teamA);
                console.log('Team A Overlap:', teamAOverlap);

                const teamBOverlap = existingMatches.some(match => match.select_team_A.team_name === teamB || match.select_team_B.team_name === teamB);
                console.log('Team B Overlap:', teamBOverlap);

                const dateOverlap = existingMatches.some(match => {
                    const matchStartDateStr = match.match_start_date;
                    const [year, month, day] = matchStartDateStr.split(/[- ]+/); // Assuming date is in "YYYY-MM-DD"
                    const matchStartDate = `${year}-${month}-${day}`;

                    const [startYear, startMonth, startDay] = startDate.split(/[- ]+/);
                    const startDateObj = `${startYear}-${startMonth}-${startDay}`;

                    // Check if dates and teams overlap
                    const teamsOverlap = (match.select_team_A.team_name === teamA || match.select_team_B.team_name === teamA) ||
                        (match.select_team_A.team_name === teamB || match.select_team_B.team_name === teamB);

                    return startDateObj === matchStartDate && teamsOverlap;
                });
                console.log('Date and Teams Overlap:', dateOverlap);

                return { teamAOverlap, teamBOverlap, dateOverlap };
            }


            document.getElementById('select-player-A').addEventListener('click', function () {
                const dropdown = document.getElementById('dropdown-players-A');
                if (!dropdown.disabled) {
                    dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
                    if (dropdown.style.display === 'block') {
                        const searchInput = dropdown.querySelector('.search-input');
                        if (searchInput) {
                            searchInput.value = ''; // Clear input field
                            filterPlayers('', 'dropdown-players-A'); // Reset player list
                            searchInput.focus();
                        }
                    }
                }
            });

            document.getElementById('select-player-B').addEventListener('click', function () {
                const dropdown = document.getElementById('dropdown-players-B');
                if (!dropdown.disabled) {
                    dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
                    if (dropdown.style.display === 'block') {
                        const searchInput = dropdown.querySelector('.search-input');
                        if (searchInput) {
                            searchInput.value = ''; // Clear input field
                            filterPlayers('', 'dropdown-players-B'); // Reset player list
                            searchInput.focus();
                        }
                    }
                }
            });

            // Initial fetch of leagues when DOM content is loaded


            function validateLeagueSelection() {
                const leagueSelect = document.getElementById('league-name');
                const errorSpan = document.getElementById('error-league-name');
                if (!leagueSelect || !errorSpan) {
                    console.error('League selection elements not found');
                    return false;
                }

                function validate() {
                    if (leagueSelect.value === '') {
                        errorSpan.innerHTML = 'Please select a league';
                        errorSpan.style.display = 'inline';
                        return false;
                    } else {
                        errorSpan.style.display = 'none';
                        return true;
                    }
                }

                leagueSelect.addEventListener('change', validate);
                return validate();
            }

            // Validate team selection
            function validateTeamSelection() {
                const teamSelectA = document.getElementById('team-A');
                const teamSelectB = document.getElementById('team-B');
                const errorSpanA = document.getElementById('error-team-A');
                const errorSpanB = document.getElementById('error-team-B');

                function validateTeam(teamSelect, errorSpan) {
                    if (!teamSelect || !errorSpan) {
                        console.error('Team selection elements not found');
                        return false;
                    }

                    function validate() {
                        if (teamSelect.value === '') {
                            errorSpan.innerHTML = 'Please select a team';
                            errorSpan.style.display = 'inline';
                            return false;
                        } else {
                            errorSpan.style.display = 'none';
                            return true;
                        }
                    }

                    teamSelect.addEventListener('change', validate);
                    return validate();
                }

                const validTeamA = validateTeam(teamSelectA, errorSpanA);
                const validTeamB = validateTeam(teamSelectB, errorSpanB);

                return validTeamA && validTeamB;
            }

            // Validate player selection
            // Validate player selection
            function validatePlayerSelection() {
                const teamASelected = document.getElementById('team-A').value;
                const teamBSelected = document.getElementById('team-B').value;
                const errorSpanA = document.getElementById('error-players-A');
                const errorSpanB = document.getElementById('error-players-B');

                function validatePlayers(teamSelect, errorSpan, teamId) {
                    if (!teamSelect || !errorSpan) {
                        console.error('Team selection elements not found');
                        return false;
                    }

                    function validate() {
                        const selectedPlayers = document.querySelectorAll(`#selected-players-${teamId} .player-option`);
                        if (selectedPlayers.length === 0) {
                            errorSpan.innerHTML = `Please select at least one player for Team ${teamId}`;
                            errorSpan.style.display = 'inline';
                            return false;
                        } else {
                            errorSpan.style.display = 'none';
                            return true;
                        }
                    }

                    const playerSelect = document.getElementById(`select-player-${teamId}`);
                    playerSelect.addEventListener('change', validate);
                    return validate();
                }

                const validTeamA = validatePlayers(teamASelected, errorSpanA, 'A');
                const validTeamB = validatePlayers(teamBSelected, errorSpanB, 'B');

                return validTeamA && validTeamB;
            }

            // Validate match dates
            function validateMatchDates() {
                const startDate = document.getElementById('match-start-date');
                // const endDate = document.getElementById('match-end-date');
                const errorSpanStart = document.getElementById('error-match-start-date');
                // const errorSpanEnd = document.getElementById('error-match-end-date');

                function validateDate(dateInput, errorSpan) {
                    if (!dateInput || !errorSpan) {
                        console.error('Date input elements not found');
                        return false;
                    }

                    function validate() {
                        if (!dateInput.value) {
                            errorSpan.innerHTML = 'Please select a date';
                            errorSpan.style.display = 'inline';
                            return false;
                        } else {
                            errorSpan.style.display = 'none';
                            return true;
                        }
                    }

                    dateInput.addEventListener('change', validate);
                    return validate();
                }

                const validStartDate = validateDate(startDate, errorSpanStart);
                // const validEndDate = validateDate(endDate, errorSpanEnd);

                return validStartDate 
            }
            function validateForm() {
                const leagueValid = validateLeagueSelection();
                const teamValid = validateTeamSelection();
                const playerValid = validatePlayerSelection();
                const datesValid = validateMatchDates();

                return leagueValid && teamValid && playerValid && datesValid;
            }
            // Fetch initial data

            async function myFetch(url, type, data) {
                try {
                    let responseData;

                    if (type === "GET") {
                        const res = await fetch(url, {
                            method: type,
                            headers: {
                                'Content-Type': 'application/json'
                            }
                        });

                        if (res.ok) {
                            console.log("HTTP request successful");
                        } else {
                            console.log("HTTP request unsuccessful");
                        }

                        responseData = await res.json();
                        return responseData.data; // Assuming the API returns data array
                    } else if (type === "DELETE") {
                        const res = await fetch(url, {
                            method: type,
                            headers: {
                                'Content-Type': 'application/json'
                            }
                        });

                        if (res.ok) {
                            console.log("HTTP request successful");
                        } else {
                            console.log("HTTP request unsuccessful");
                        }

                        return res;
                    } else if (type === "POST" || type === "PUT") {
                        const res = await fetch(url, {
                            method: type,
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(data)
                        });

                        if (res.ok) {
                            console.log("HTTP request successful");
                        } else {
                            console.log("HTTP request unsuccessful");
                        }

                        responseData = await res.json();
                        return responseData;
                    }
                } catch (error) {
                    console.error("Fetch error:", error);
                    throw error; // Re-throw the error to handle it where myFetch is called
                }
            }
            let existingMatches = []
            existingMatches = await myFetch("https://krinik.pythonanywhere.com/match_get/", "GET");
            console.log(existingMatches, "ok")


            try {
                await fetchLeagues(); // Fetch leagues initially

                const form = document.getElementById('match-form');
                form.addEventListener('submit', async function (event) {
                    event.preventDefault();

                    // Collect all necessary form data
                    const leagueName = document.getElementById('league-name').value;

                    const teamA = document.getElementById('team-A').value;
                    const teamB = document.getElementById('team-B').value;
                    const startDate = document.getElementById('match-start-date').value;

                    const newarr = new Set(arr) 
                    console.log(newarr,"newarr")

                    // Collect selected players' names for Team A
                    const selectedPlayersA = Array.from(document.querySelectorAll('#selected-players-A .player-option'))
                        .map(player => player.dataset.id.trim());
                    console.log(selectedPlayersA, "playernameche")

                    // Collect selected players' names for Team B
                    const selectedPlayersB = Array.from(document.querySelectorAll('#selected-players-B .player-option'))
                        .map(player => player.dataset.id.trim());

                    // FormData object to send via fetch
                    const formData = new FormData();
                    formData.append('select_league', leagueName);
                    formData.append('select_team_A', teamA);
                    formData.append('select_team_B', teamB);
                       
                    newarr.forEach(playerId => {
                        formData.append('player_list', playerId);
                    });


                    // Append each player individually to formData for select_player_A
                    selectedPlayersA.forEach(player => {
                        formData.append('select_player_A', player);
                    });
                    console.log("playernamewithid", selectedPlayersA)
                    // Append each player individually to formData for select_player_B
                    selectedPlayersB.forEach(player => {
                        formData.append('select_player_B', player);
                    });

                    formData.append('match_start_date', document.getElementById('match-start-date').value);
                    
                    const overlapResult = checkOverlap(teamA, teamB, startDate, existingMatches);

                    // Log form data for verification
                    console.log('Form data before sending:');
                    formData.forEach((value, key) => {
                        console.log(key, value);
                    });

                    // Check if the form is valid
                    if (validateForm()) {

                        // Handle overlap errors
                        if (overlapResult.teamAOverlap && overlapResult.teamBOverlap && overlapResult.dateOverlap) {
                            document.getElementById('error-team-A').innerHTML = 'Team-A name already exists';
                            document.getElementById('error-team-A').style.display = 'inline';
                            document.getElementById('error-team-B').innerHTML = 'Team-B name already exists';
                            document.getElementById('error-team-B').style.display = 'inline';

                        } else if (overlapResult.teamAOverlap && overlapResult.dateOverlap) {
                            document.getElementById('error-team-A').innerHTML = 'Team-A name already exists';
                            document.getElementById('error-team-A').style.display = 'inline';

                        } else if (overlapResult.teamBOverlap && overlapResult.dateOverlap) {

                            document.getElementById('error-team-B').innerHTML = 'Team-B name already exists';
                            document.getElementById('error-team-B').style.display = 'inline';
                        } else {
                            // Proceed with form submission if there are no overlap errors
                            if (confirm("Are you sure you want to add this match?")) {
                                try {
                                    const response = await fetch('https://krinik.pythonanywhere.com/match_get/', {
                                        method: 'POST',
                                        body: formData
                                    });

                                    if (!response.ok) {
                                        const errorText = await response.text();
                                        throw new Error(`Failed to submit match data: ${response.status} ${response.statusText} - ${errorText}`);
                                    }

                                    const responseData = await response.json();
                                    console.log('Response data:', responseData);
                                    window.location.href = 'manage-match.html'; // Redirect on successful submission
                                } catch (error) {
                                    console.error('Error:', error);
                                    alert('An error occurred while submitting the match data.');
                                }
                            }
                        }
                    } else {
                        console.log('Form validation failed. Please check all fields.');
                    }

                });

            } catch (error) {
                console.error('Error during DOMContentLoaded event:', error);
            }

        });



    </script>




</body>

</html>