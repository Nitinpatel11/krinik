<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>View Pool Details</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description" />
    <meta content="Themesdesign" name="author" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <!-- App favicon -->
    <!-- <link rel="shortcut icon" href="./assets/images/favicon.ico" /> -->
    <link rel="icon" href="./assets/images/krinikIn_Logo.svg" type="image/x-icon" >
    <!-- DataTables -->
    <link href="./assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css" />
    <link href="./assets/libs/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css" rel="stylesheet"
        type="text/css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />



    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />



    <!-- Responsive datatable examples -->
    <link href="./assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet"
        type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- datepicker -->
    <link href="./assets/libs/air-datepicker/air-datepicker.css" rel="stylesheet" />

    <!-- jvectormap -->
    <!-- <link href="./assets/libs/jqvmap/jqvmap.min.css" rel="stylesheet" /> -->

    <!-- Bootstrap Css -->
    <link href="./assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <!-- Icons Css -->
    <link href="./assets/css/icons.min.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,300,0,0" />
    <!-- App Css-->
    <link href="./assets/css/app.css" rel="stylesheet" type="text/css" />
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,300,0,0" />
    <style>
        .table-wrapper {
            overflow-x: auto;
        }

        .btn-disable {
            background: transparent;
            border: none;
            color: red;
            font-size: 1.5em;
        }

        .btn-disable:focus {
            outline: none;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        .status-buttons {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .status-buttons .btn {
            width: 100%;
            max-width: 200px;
            margin-bottom: 10px;
        }

        .team-logo {
            background-color: #d3d3d3;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            text-align: center;
        }

        .team {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }

        .match-info {
            text-align: center;
        }

        .compact {
            padding: 0.5rem;
        }

        @media (max-width: 576px) {
            .team {
                flex-direction: column;
            }

            .team-logo {
                width: 60px;
                height: 60px;
            }
        }

        @media (min-width: 768px) {
            .team-container {
                flex: 1 1 auto;
                max-width: 25%;
            }

            .match-info {
                flex: 0 1 auto;
                max-width: 20%;
            }
        }

        @media (max-width: 375px) {
            .container {
                flex-direction: column;
            }

            .team-container,
            .match-info {
                max-width: 100%;
            }

            .match-info {
                margin: 1rem 0;
            }
        }
    </style>
</head>

<body data-topbar="colored">
    <!-- Begin page -->
    <div id="layout-wrapper">
      <header id="page-topbar" class="">
        <div class="navbar-header ">
          <div class="d-flex ">
            <!-- LOGO -->
            <div class="navbar-brand-box">
              <a href="./dashboard.html" class="logo logo-dark">
                <span class="logo-sm">
                  
                  <img src="./assets/images/krinikIn_Logo.svg" alt="" />
                </span>
                <span class="logo-lg">
                
                  <img src="./assets/images/krinikIn_Logo.svg" alt=""  />
                </span>
              </a>
  
              <a href="index.html" class="logo logo-light ">
                <span class="logo-sm">
               
                  <img src="./assets/images/krinikIn_Logo.svg" alt=""  />
                </span>
                <span class="logo-lg">
                  
                  <img src="./assets/images/krinikIn_Logo.svg" alt="" />
                </span>
              </a>
            </div>
  
            <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect " id="vertical-menu-btn">
              <i class="mdi mdi-backburger "></i>
            </button>
  
            <!-- App Search-->
            <!-- <form class="app-search d-none d-lg-block">
                              <div class="position-relative mt-3">
                                  <input type="text" class="form-control" placeholder="Search...">
                                  <span class="mdi mdi-magnify"></span>
                              </div>
                          </form> -->
          </div>
  
          <div class="  d-flex justify-content-center gap-4 time_show1">
            <div class="dropdown d-flex justify-content-end ms-2  " id="enterotpdiv">
              <!-- <button id="showotppage" type="button" class="btn btn-primary2  waves-effect" 
               >Enter OTP
              </button> -->
              
            </div>
          
            <div class="dropdown   dblock">
              <div id="time_show" class="btn-primary2  px-3">
              </div>
            </div>
  
            
          </div>
          
        </div>
      </header>
  
         <!-- ========== Left Sidebar Start ========== -->
     <div class="vertical-menu ">
      <div data-simplebar class="h-100 ">
        <!--- Sidemenu -->
        <div id="sidebar-menu" class="">
          <!-- Left Menu Start -->
          <ul class="metismenu list-unstyled " id="side-menu">
            <li class="menu-title">Menu</li>

            <li>
              <a href="./dashboard.html" class="waves-effect">
                <div class=" icons-sm icon-set">
                  <span class="material-symbols-outlined icon-margin">
                    dashboard
                    </span>
               
                <span>Dashboard</span>
                </div>
              </a>
            </li>

            <li>
              <a href="./user.html" class="waves-effect">
                <div class="icons-sm icon-set">
                  <span class="material-symbols-outlined icon-margin">
                    person
                    </span>
               
                <span>User</span>
              </div>
              </a>
            </li>

            <li>
              <a href="javascript: void(0);" class=" ">
                <div class="icons-sm icon-set ">
                  <span class="material-symbols-outlined icon-margin">
                    sports_cricket
                    </span>                    
                    <span class="has-arrow waves-effect ">Sports Configuration</span>
                                    
                  </div> 
                  
                </a>

              <ul class="sub-menu" aria-expanded="false">
                <li><a href="./manage-league.html">Manage Leagues</a></li>
                <li><a href="./manage-team.html">Manage Teams</a></li>
                <li><a href="./manage-player.html">Manage Players</a></li>
              </ul>
            </li>
            
            <li>
              <a href="javascript: void(0);" class=" ">
                <div class="icons-sm icon-set ">
                  <span class="material-symbols-outlined icon-margin">
                    crossword
                    </span>                   
                    <span class="has-arrow has-arrow1 waves-effect ">Manage Contest</span>
                                    
                  </div> 
                  
                </a>

              <ul class="sub-menu" aria-expanded="false">
                <li><a href="./manage-match.html">Manage Match</a></li>
                <li><a href="./manage-pool.html">Manage Pools</a></li>
              </ul>
            </li>

            <li class="otp-exempt" style="display:none">
              <a href="javascript: void(0);" class=" ">
                <div class="icons-sm icon-set ">
                  <span class="material-symbols-outlined icon-margin">
                    receipt_long
                    </span>                 
                    <span class="has-arrow has-arrow2 waves-effect ">Transactions</span>
                                    
                  </div> 
                  
                </a>

              <ul class="sub-menu" aria-expanded="false">
                <li><a href="./all-transaction.html">All Transaction</a></li>
                <li><a href="./wallet-transaction.html">Wallet Transaction</a></li>
                <li><a href="./game-transaction.html">Game Transaction</a></li>
              </ul>
            </li>

            <li class="otp-exempt" style="display:none">
              <a href="./account-setting.html" class="waves-effect">
                <div class="icons-sm icon-set ">
                  <span class="material-symbols-outlined icon-margin">
                    settings
                    </span>
                    <span>Account Setting</span>
                </div>
              </a>
            </li>

            <li>
              <a href="" class="waves-effect " id="logoutButton">
                <div class=" icons-sm icon-set ">
                  <span class="material-symbols-outlined icon-margin ">
                    logout
                    </span>
                    <span class="">Logout</span>
                </div>
              </a>
            </li>

          
                    </ul>
        </div>
        <!-- Sidebar -->
      </div>
    </div>
    <!-- Left Sidebar End -->


    <div class="main-content">
        <div class="page-content">
            <!-- Page-Title -->
            <div class="page-title-box">
                <div class="container-fluid">
                    <div class="row align-items-center">

                        <div>
                            <h4 class="page-title mb-1">View Contest Details</h4>
                        </div>
                    </div>
                </div>
            </div>



            <div class="mainDiv">
                <div class="page-content-wrapper">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-xl-12 col-md-12 col-sm-12 ">
                                <!-- Center align on small screens -->
                                <div class=" mb-5">
                                    <!-- <div class="py-2"> -->
                                      <h4 id="contestName" class="contest-name"></h4>
                                        <!-- <div  class="d-flex align-items-center flex-wrap justify-content-xl-start justify-content-center"> -->
                                            <!-- Left align on xl screens, center align on smaller screens -->
                                            <!-- <div class="team-container compact">
                                                <div class="team">
                                                    <div class="team-logo">Team Logo</div>
                                                    <div class="ml-md-2 mt-2 mt-md-0 ms-1 fs-6 fw-bold">IND</div>
                                                </div>
                                            </div>
                                            <div class="match-info compact">
                                                <div>2h 30m</div>
                                            </div>
                                            <div class="team-container compact">
                                                <div class="team">
                                                    <div class="team-logo">Team Logo</div>
                                                    <div class="ml-md-2 mt-2 mt-md-0 ms-1 fs-6 fw-bold">MUM</div>
                                                </div>
                                            </div> -->
                                        <!-- </div> -->
                                    <!-- </div> -->
                                </div>
                            </div>
                        </div>
                    </div>



                    <div class="page-content-wrapper">
                        <div class="container-fluid ">
                            <div class="row mt-4">

                                <div class="col-xl-3">
                                    <div class="card text-center">
                                        <div class="card-body">
                                            <div class="row justify-content-center">
                                                <h5>Total Amount</h5>
                                                <div class="col-6">

                                                    <div class="mt-2">
                                                        <span href="#"
                                                            class="btn btn-primary btn-sm data-padding text-center"
                                                            id="total-league-data">10000
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>



                                <div class="col-xl-3">
                                    <div class="card text-center">
                                        <div class="card-body">
                                            <div class="row justify-content-center">
                                                <h5>Total Win</h5>
                                                <div class="col-6">

                                                    <div class="mt-2">
                                                        <span href="#"
                                                            class="btn btn-primary btn-sm data-padding text-center"
                                                            id="total-league-data">100
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <div class="col-xl-3">
                                    <div class="card text-center">
                                        <div class="card-body">
                                            <div class="row justify-content-center">
                                                <h5>Total Available</h5>
                                                <div class="col-6">

                                                    <div class="mt-2">
                                                        <span href="#"
                                                            class="btn btn-primary btn-sm data-padding text-center"
                                                            id="total-league-data">10000
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>

                           


                            <div class="col-xl-12 col-md-12 col-sm-11">

                                <div class="card p-2">
                                    <div class="card-body">

                                        <div class="container">
                                            <div class="status-buttons">
                                                <button class="btn btn-primary">Status (Live/Completed)</button>
                                                <button class="btn btn-primary mt-2" id="contestResult">Declare Result</button>
                                            </div>
                                            <div class="table-wrapper mt-3">
                                                <table class="table table-bordered text-center" id="contestTable">
                                                    <thead>
                                                        <tr>
                                                            <th>No</th>
                                                            <th colspan="2">Username</th>
                                                            <th colspan="2">Enter Amount</th>
                                                            <th>Pair</th>
                                                            <th>Total Pool</th>
                                                            <th>Refund/Kick</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>

                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>


                                    </div>
                                </div>
                            </div>
                        </div>



                        <footer class="footer">
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col-sm-6">2024 Â© Krinik.</div>
                                    <div class="col-sm-6">
                                        <div class="text-sm-end d-none d-sm-block">
                                            Crafted with <i class="mdi mdi-heart text-danger"></i> by
                                            Themesdesign
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </footer>


                    </div>
                </div>
</div>
</div>
</div>
</div>

</body>
<script>
   var rankList = [];
  var array = [];
  var array_length = 0;
  var table_size = 10;
  var start_index = 1;
  var end_index = 0;
  var current_index = 1;
  var max_index = 0;// Define end_index or calculate based on data length

const urlParams = new URLSearchParams(window.location.search);
const id = urlParams.get('id');


async function fetchUserData() {
    try {
      if (!id) {
        console.warn('No player ID found in URL.');
        return;
      }

      const url = `https://krinik.pythonanywhere.com/add_pool_get/${id}/`;
      console.log('Fetching player data from:', url);

      const response = await fetch(url);
      if (!response.ok) {
        throw new Error('Failed to fetch player data');
      }

      const userData1 = await response.json();
      const userData = userData1.data;
      userId = userData.id;

      console.log(userData, "data");
      fetchData(userId);
    } catch (error) {
      console.error('Error fetching player data:', error);
    }
  }

  async function fetchData(userId) {
    try {
      const response = await fetch(`https://krinik.pythonanywhere.com/view_contest_details_view_get/`);
      if (!response.ok) {
        throw new Error('Failed to fetch pool history data');
      }

      
      const userData1 = await response.json();

      if (userData1 && userData1.status === "success" && userData1.data) {
        rankList = userData1.data;
        console.log(rankList, "arr");

        // Filter and log matching data
        const matchingData = rankList.filter(item => item.user_data.id === userId);
        if (matchingData.length > 0) {
          console.log('Matching data found:', matchingData);
        } else {
          console.log('No matching data found.');
        }

        array = matchingData;
        // filterAndDisplay();

        // const userData1 = await response.json();
//         rankList = userData1.data;
//           array = rankList;
//           console.log(array)
        filterAndDisplay()
        editPlayerData(array);
      } else {
        console.error("Error: Invalid data format or ID mismatch");
      }
    } catch (error) {
      console.error("Error fetching data", error);
    }
  }

function editPlayerData(response) {
    const contestName = document.getElementById("contestName");
    // const teamLogo2 = document.getElementById("team-logo-2");
    // const teamLogoName1 = document.getElementById("team-logo-name-1");
    // const teamLogoName2 = document.getElementById("team-logo-name-2");

    if (response) {
        // const data = response[0];

        // teamLogo1.src = `https://krinik.pythonanywhere.com${response.select_team_A.team_image}`;
        // teamLogo2.src = `https://krinik.pythonanywhere.com${response.select_team_B.team_image}`;

        contestName.textContent = response.pool_name;
        // teamLogoName2.textContent = response.select_team_B.team_name;

        // displayTableRows(response.select_player_A, "tbody1");
        // displayTableRows(response.select_player_B, "tbody2");
    } else {
        console.error("Data is not in the expected format:", response);
    }
}





fetchUserData();



  function filterAndDisplay() {
    // filterRankList();
    preLoadCalculations();
    displayIndexButtons();
    displayTableRows();
    highlightIndexButton();
  }

  function preLoadCalculations(filteredArrayLength) {
    array_length = filteredArrayLength || array.length;
    max_index = Math.ceil(array_length / table_size);
  }


  function displayIndexButtons() {
  $(".index_buttons ul").empty();

  if (array_length <= table_size) {
      // If there are 10 or fewer items, do not show pagination
      return;
  }

  if (current_index > 1) {
      $(".index_buttons ul").append('<li><button class="paginate_button page-item previous" onclick="prev()">Previous</button></li>');
  }

  const show_page = getElidedPageRange(current_index, max_index);

  show_page.forEach(i => {
      if (i === current_index) {
          $(".index_buttons ul").append('<li><button class="paginate_button page-item active">' + i + '</button></li>');
      } else if (i === "...") {
          $(".index_buttons ul").append('<li><button class="paginate_button page-item">...</button></li>');
      } else {
          $(".index_buttons ul").append('<li><button class="paginate_button page-item" onclick="indexPagination(' + i + ')">' + i + '</button></li>');
      }
  });

  if (current_index < max_index) {
      $(".index_buttons ul").append('<li><button class="paginate_button page-item next" onclick="next()">Next</button></li>');
  }

  highlightIndexButton();
}


  function getElidedPageRange(current, total) {
      const delta = 1;
      const range = [];
      const left = current - delta;
      const right = current + delta + 1;
      let last = 0;

      for (let i = 1; i <= total; i++) {
          if (i === 1 || i === total || (i >= left && i < right)) {
              if (last + 1 !== i) {
                  range.push("...");
              }
              range.push(i);
              last = i;
          }
      }

      return range;
  }

  function highlightIndexButton() {
      start_index = (current_index - 1) * table_size + 1;
      end_index = Math.min(start_index + table_size - 1, array_length);
      $("#datatable_info").text("Showing " + start_index + " to " + end_index + " of " + array_length + " items");
      $(".index_buttons ul a").removeClass("active");
      $('.index_buttons ul a').each(function () {
          if ($(this).text() == current_index) {
              $(this).addClass("active");
          }
      });
      displayTableRows();
  }
  function prev() {
      if (current_index > 1) {
          current_index--;
          displayIndexButtons();
          highlightIndexButton();
      }
  }

  function next() {
      if (current_index < max_index) {
          current_index++;
          displayIndexButtons();
          highlightIndexButton();
      }
  }

  function indexPagination(index) {
      current_index = index;
      displayIndexButtons();
      highlightIndexButton();
  }



  function displayTableRows() {
    $("table tbody").empty();
    var tab_start = start_index - 1;
    var tab_end = end_index;

    if (array.length === 0) {
      $("#noDataFound").show();
      $("#pagination").hide();
      $("#table-scrolling").css("overflow-x", "hidden"); // Add this line
      return;
    } else {
      $("#noDataFound").hide();
      $("#pagination").show();
      $("#table-scrolling").css("overflow-x", "auto"); // Add this line
    }

    for (var i = tab_start; i < tab_end; i++) {
      var showdata = array[i];
      // var status = getStatus(showdata["start_league_date"], showdata["end_league_date"]);

      var tr = $("<tr></tr>");

      var noCell = $("<td></td>").text(i + 1);
      var userNameCell = $("<td colspan='2'></td>").text(showdata.user_data["name"] || "");
      var amountCell = $("<td colspan='2'> </td>").text(showdata["entry_fee"] || "");

      // var logoCell = $("<td></td>").html(
      //   showdata["league_image"]
      //     ? `<img src="https://krinik.pythonanywhere.com${showdata["league_image"]}" alt="" class="team-logo lazyload" />`
      //     : ""
      // );
      var pairCell = $("<td colspan='2'></td>").text(showdata.user_data["pool_name"].length || "");
      var totalPoolCell = $("<td colspan='2'> </td>").text(showdata["player_pair"].length || "");

      // var dateCell = $("<td colspan='2'></td>").text(
      //   (showdata["start_league_date"] || "") +
      //   " - " +
      //   (showdata["end_league_date"] || "")
      // );
      // var statusCell = $("<td colspan='2'></td>").text(status);
      // var viewCell = $("<td></td>").html(
      //   // '<span class="sortable" onclick="window.location.href=\'view-league-details.html\'"><i class="far fa-eye"></i></span>'
      //     '<span class="sortable" onclick="viewLeagueDetails(\'' + showdata["league_name"] + '\')"><i class="far fa-eye"></i></span>'
      // );
      // var editCell = $("<td></td>").html(
      //   '<span class="sortable" onclick="handleEdit(' + showdata["id"] + ')"><i class="far fa-edit"></i></span>'
      // );
      var deleteCell = $("<td></td>").html(
        '<span class="sortable" onclick="handleDelete(' + showdata["id"] + ')"><i class="far fa-trash-alt"></i></span>'
      );

      tr.append(noCell)
        .append(userNameCell)
        .append(amountCell)
        .append(pairCell)
        .append(totalPoolCell)
        // .append(logoCell)
        // .append(dateCell)
        // .append(statusCell)
        // .append(viewCell)
        // .append(editCell)
        .append(deleteCell);

    

      $("table tbody").append(tr);
    }
  }

  function redirectToHistoryPage(page) {
  const urlParams = new URLSearchParams(window.location.search);
  const name = urlParams.get('name');
  
  if (id) {
    window.location.href = `${page}.html?id=${id}`;
  } else {
    console.error('No player ID found in URL.');
  }
}

document.getElementById("contestResult").addEventListener("click", () => redirectToHistoryPage('contest-result'));

const table = document.getElementById('contestTable');
const downloadBtn = document.getElementById('download-btn');

downloadBtn.addEventListener('click', () => {
const workbook = XLSX.utils.table_to_book(table, { sheet: 'Contest Data' });
const excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
const data = new Blob([excelBuffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
const url = URL.createObjectURL(data);
const a = document.createElement('a');
a.href = url;
a.download = 'contest_data.xlsx';
a.click();

URL.revokeObjectURL(url);
a.remove();
});
</script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.17.4/dist/xlsx.full.min.js"></script>

<script src="./assets/js/logout.js"></script>

    <script src="assets/libs/jquery/jquery.min.js"></script>
        <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/libs/metismenu/metisMenu.min.js"></script>
        <script src="assets/libs/simplebar/simplebar.min.js"></script>
        <script src="assets/libs/node-waves/waves.min.js"></script>

        <script src="https://unicons.iconscout.com/release/v2.0.1/script/monochrome/bundle.js"></script>


        <script src="assets/js/app.js"></script>
</html>