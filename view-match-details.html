<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>View Match Details</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta content="Premium Multipurpose Admin & Dashboard Template" name="description" />
  <meta content="Themesdesign" name="author" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <!-- App favicon -->
  <!-- <link rel="shortcut icon" href="./assets/images/favicon.ico" /> -->
  <link rel="icon" href="./assets/images/krinikIn_Logo.svg" type="image/x-icon">
  <!-- DataTables -->
  <link href="./assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css" />
  <link href="./assets/libs/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css" rel="stylesheet"
    type="text/css" />
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />



  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />



  <!-- Responsive datatable examples -->
  <link href="./assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet"
    type="text/css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <!-- datepicker -->
  <link href="./assets/libs/air-datepicker/air-datepicker.css" rel="stylesheet" />
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,300,0,0" />
  <!-- jvectormap -->
  <!-- <link href="./assets/libs/jqvmap/jqvmap.min.css" rel="stylesheet" /> -->

  <!-- Bootstrap Css -->
  <link href="./assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
  <!-- Icons Css -->
  <link href="./assets/css/icons.min.css" rel="stylesheet" type="text/css" />
  <!-- App Css-->
  <link href="./assets/css/app.css" rel="stylesheet" type="text/css" />
  <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
  <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .table-wrapper {
      overflow-x: auto;
    }

    .btn-disable {
      background: transparent;
      border: none;
      color: red;
      font-size: 1.5em;
    }

    .btn-disable:focus {
      outline: none;
    }

    .table-wrapper {
      overflow-x: auto;
    }

    .status-buttons {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
    }

    .status-buttons .btn {
      width: 100%;
      max-width: 200px;
      margin-bottom: 10px;
    }

    .team-logo {
      background-color: #d3d3d3;
      overflow: hidden;
      margin: auto;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 1px solid grey;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9em;
      text-align: center;
      margin-bottom: 20px;
    }


    .team-logo img {
      height: 100%;
      width: 100%;
    }

    .team-logo1 {
      /* background-color: #d3d3d3; */
      margin: auto;
      width: 75px;
      height: 75px;
      border-radius: 50%;
      overflow: hidden;
      border: 1px solid grey;
      /* display: flex;
    align-items: center;
    justify-content: center; */
      /* font-size: 0.9em; */
      /* text-align: center; */
      /* margin-bottom: 20px; */
      /* object-fit: cover; */
    }

    .team-logo1 img {
      height: 100% !important;
      width: 100% !important;
      object-fit: cover;
    }

    .team {
      /* display: flex; */
      align-items: center;
      justify-content: center;
      /* flex-wrap: nowrap; */
    }

    .match-info {
      text-align: center;
    }

    .compact {
      padding: 0.5rem;
    }

    @media (max-width: 576px) {
      .team1 {
        display: flex;
        flex-direction: column;
      }

      .team-logo {
        width: 60px;
        height: 60px;
      }


    }

    @media (min-width: 768px) {
      .team-container {
        flex: 1 1 auto;
        max-width: 25%;
      }

      .match-info {
        flex: 0 1 auto;
        max-width: 20%;
      }
    }

    @media (max-width: 375px) {
      .container {
        flex-direction: column;
      }

      .team-container,
      .match-info {
        max-width: 100%;
      }

      .match-info {
        margin: 1rem 0;
      }
    }

    /* Container for checkboxes */
    .form-check {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
      /* Space between checkboxes */
    }

    /* Checkbox input */
    .form-check-input {
      margin-right: 10px;
      /* Space between checkbox and label */
      width: 20px;
      height: 20px;
      cursor: pointer;
      /* Show pointer cursor on hover */
    }

    /* Checkbox label */
    .form-check-label {
      font-size: 24px;
      /* Increase font size for better readability */
      color: #333;
      /* Dark color for the text */
      cursor: pointer;
      /* Show pointer cursor on hover */
      margin-left: 40px;
    }

    /* Hover effect for checkbox labels */
    /* .form-check-label:hover {
    color: #E20101; /* Change color on hover */
    /* text-decoration: underline; /* Underline text on hover */
    /* } */

    /* Optional: Custom checkbox appearance */
    .form-check-input:checked {
      background-color: #E20101;
      /* Change background color when checked */
      border-color: #E20101;
      /* Change border color when checked */
    }

    .form-check-input[type=checkbox] {
      border-radius: .25em;
      width: 30px;
      height: 30px;
      border: 1px solid grey;
    }

    /* Optional: Custom checkbox appearance when focused */
    .form-check-input:focus {
      box-shadow: 0 0 0 0.2rem rgba(75, 77, 79, 0.25);
      /* Add focus shadow */
    }

    .form-check .form-check-input {
      float: left;
      margin-left: 0em !important;
    }

    .btn-ponter{
    cursor: auto !important;
    border: none !important;
    outline: none !important;
    transition: none !important;
  }

  .btn-ponter:focus{
    outline: none !important;
    border: none !important;
    box-shadow: none;
  }
  </style>
</head>

<body data-topbar="colored">
  <!-- Begin page -->
  <div id="layout-wrapper">
    <header id="page-topbar" class="">
      <div class="navbar-header ">
        <div class="d-flex ">
          <!-- LOGO -->
          <div class="navbar-brand-box">
            <a href="./dashboard.html" class="logo logo-dark">
              <span class="logo-sm">
                
                <img src="./assets/images/krinikIn_Logo.svg" alt="" />
              </span>
              <span class="logo-lg">
              
                <img src="./assets/images/krinikIn_Logo.svg" alt=""  />
              </span>
            </a>

            <a href="index.html" class="logo logo-light ">
              <span class="logo-sm">
             
                <img src="./assets/images/krinikIn_Logo.svg" alt=""  />
              </span>
              <span class="logo-lg">
                
                <img src="./assets/images/krinikIn_Logo.svg" alt="" />
              </span>
            </a>
          </div>

          <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect " id="vertical-menu-btn">
            <i class="mdi mdi-backburger "></i>
          </button>

          <!-- App Search-->
          <!-- <form class="app-search d-none d-lg-block">
                            <div class="position-relative mt-3">
                                <input type="text" class="form-control" placeholder="Search...">
                                <span class="mdi mdi-magnify"></span>
                            </div>
                        </form> -->
        </div>

        <div class="  d-flex justify-content-center gap-4 time_show1">
          <div class="dropdown d-flex justify-content-end ms-2  " id="enterotpdiv">
            <!-- <button id="showotppage" type="button" class="btn btn-primary2  waves-effect" 
             >Enter OTP
            </button> -->
            
          </div>
        
          <div class="dropdown   dblock">
            <div id="time_show" class="btn-primary2  px-3">
            </div>
          </div>

          
        </div>
        
      </div>
    </header>

       <!-- ========== Left Sidebar Start ========== -->
       <div class="vertical-menu ">
        <div data-simplebar class="h-100 ">
          <!--- Sidemenu -->
          <div id="sidebar-menu" class="">
            <!-- Left Menu Start -->
            <ul class="metismenu list-unstyled " id="side-menu">
              <li class="menu-title">Menu</li>
  
              <li>
                <a href="./dashboard.html" class="waves-effect">
                  <div class=" icons-sm icon-set">
                    <span class="material-symbols-outlined icon-margin">
                      dashboard
                      </span>
                 
                  <span>Dashboard</span>
                  </div>
                </a>
              </li>
  
              <li>
                <a href="./user.html" class="waves-effect">
                  <div class="icons-sm icon-set">
                    <span class="material-symbols-outlined icon-margin">
                      person
                      </span>
                 
                  <span>User</span>
                </div>
                </a>
              </li>
  
              <li>
                <a href="javascript: void(0);" class=" ">
                  <div class="icons-sm icon-set ">
                    <span class="material-symbols-outlined icon-margin">
                      sports_cricket
                      </span>                    
                      <span class="has-arrow waves-effect ">Sports Configuration</span>
                                      
                    </div> 
                    
                  </a>
  
                <ul class="sub-menu" aria-expanded="false">
                  <li><a href="./manage-league.html">Manage Leagues</a></li>
                  <li><a href="./manage-team.html">Manage Teams</a></li>
                  <li><a href="./manage-player.html">Manage Players</a></li>
                </ul>
              </li>
              
              <li>
                <a href="javascript: void(0);" class=" ">
                  <div class="icons-sm icon-set ">
                    <span class="material-symbols-outlined icon-margin">
                      crossword
                      </span>                   
                      <span class="has-arrow has-arrow1 waves-effect ">Manage Contest</span>
                                      
                    </div> 
                    
                  </a>
  
                <ul class="sub-menu" aria-expanded="false">
                  <li><a href="./manage-match.html">Manage Match</a></li>
                  <li><a href="./manage-pool.html">Manage Pools</a></li>
                </ul>
              </li>
  
              <li class="otp-exempt" style="display:none">
                <a href="javascript: void(0);" class=" ">
                  <div class="icons-sm icon-set ">
                    <span class="material-symbols-outlined icon-margin">
                      receipt_long
                      </span>                 
                      <span class="has-arrow has-arrow2 waves-effect ">Transactions</span>
                                      
                    </div> 
                    
                  </a>
  
                <ul class="sub-menu" aria-expanded="false">
                  <li><a href="./all-transaction.html">All Transaction</a></li>
                  <li><a href="./wallet-transaction.html">Wallet Transaction</a></li>
                  <li><a href="./game-transaction.html">Game Transaction</a></li>
                </ul>
              </li>
  
              <li class="otp-exempt" style="display:none">
                <a href="./account-setting.html" class="waves-effect">
                  <div class="icons-sm icon-set ">
                    <span class="material-symbols-outlined icon-margin">
                      settings
                      </span>
                      <span>Account Setting</span>
                  </div>
                </a>
              </li>
              <li class="otp-exempt" style="display:none">
                <a href="./advertise.html" class="waves-effect">
                  <div class="icons-sm icon-set ">
                    <span class="material-symbols-outlined icon-margin">
                      ad
                      </span>
                      <span>Advertise</span>
                  </div>
                </a>
              </li>
              <li>
                <a href="./kyc.html" class="waves-effect">
                  <div class="icons-sm icon-set">
                    <span class="material-symbols-outlined icon-margin">
                      person
                      </span>
                 
                  <span>KYC</span>
                </div>
                </a>
              </li>
  
              <li>
                <a href="" class="waves-effect " id="logoutButton">
                  <div class=" icons-sm icon-set ">
                    <span class="material-symbols-outlined icon-margin ">
                      logout
                      </span>
                      <span class="">Logout</span>
                  </div>
                </a>
              </li>
  
            
                      </ul>
          </div>
          <!-- Sidebar -->
        </div>
      </div>
      
      <!-- Left Sidebar End -->


    <div class="main-content">
      <div class="page-content">
        <!-- Page-Title -->
        <div class="page-title-box">
          <div class="container-fluid">
            <div class="row align-items-center">

              <div>
                <h4 class="page-title mb-1">View Match Details</h4>
              </div>
            </div>
          </div>
        </div>



        <div class="mainDiv">
          <div class="page-content-wrapper">
            <div class="container-fluid">
              <div class="row">
                <div class="col-xl-12 col-md-12 col-sm-12 text-center">
                  <!-- Center align on small screens -->
                  <div class="card mb-5">
                    <div class="py-2">
                      <div class="d-flex align-items-center  justify-content-xl-start justify-content-center team1">
                        <!-- Left align on xl screens, center align on smaller screens -->
                        <div class="team-container compact">
                          <div class="team">
                            <div class="team-logo">
                              <img src="" alt="" id="team-logo-1">
                            </div>
                            <div class="ml-md-2 mt-2 mt-md-0 ms-1 fs-6 fw-bold"><span id="team-logo-name-1"></span>
                            </div>
                          </div>
                        </div>
                        <div class="match-info compact">
                          <div><h5 id="remainTiming"></h5></div>
                        </div>
                        <div class="team-container compact">
                          <div class="team">
                            <div class="team-logo">
                              <img src="" alt="" id="team-logo-2">
                            </div>
                            <div class="ml-md-2 mt-2 mt-md-0 ms-1 fs-6 fw-bold"><span id="team-logo-name-2"></span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>



            <div class="page-content-wrapper">
              <div class="container-fluid ">
                <div class="row mt-4">

                  <div class="col-xl-3">
                    <div class="card text-center">
                      <div class="card-body">
                        <div class="row justify-content-center">
                          <h5>Total Amount</h5>
                          <div class="col-6">

                            <div class="mt-2">
                              <span href="#" class="btn btn-primary1 btn-sm data-padding text-center"
                                id="total-amount-data">
                              </span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>



                  <div class="col-xl-3">
                    <div class="card text-center">
                      <div class="card-body">
                        <div class="row justify-content-center">
                          <h5>Total Win</h5>
                          <div class="col-6">

                            <div class="mt-2">
                              <span href="#" class="btn btn-primary1 btn-sm data-padding text-center"
                                id="total-win-data">
                              </span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>


                  <div class="col-xl-3">
                    <div class="card text-center">
                      <div class="card-body">
                        <div class="row justify-content-center">
                          <h5>Total Available</h5>
                          <div class="col-6">

                            <div class="mt-2">
                              <span href="#" class="btn btn-primary1 btn-sm data-padding text-center"
                                id="total-available-data">
                              </span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                </div>

                <div class="row">
                  <div class="col-xl-6 col-md-12 col-sm-11">
                    <div class="card p-2">
                      <div class="card-body">
                        <h3 class="text-center">Team A</h3>
                        <div class="container mt-3">
                          <div class="table-wrapper">
                            <table class="table table-bordered text-center">
                              <thead>
                                <tr>
                                  <th>No</th>
                                  <th colspan="3">Name</th>
                                  <th>Pic</th>
                                  <th>Disable</th>
                                </tr>
                              </thead>
                              <tbody id="tbody1">
                                <!-- Player rows for Team A -->
                              </tbody>
                            </table>
                          </div>
                          <div class="d-flex justify-content-end mt-3">
                            <button class="btn btn-primary1 m-1" data-toggle="modal" data-target="#addAmountModal">+ Add
                              Player Alternate...</button>
                          </div>

                          <div class="modal fade" id="addAmountModal" tabindex="-1"
                            aria-labelledby="addAmountModalLabelA" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                              <div class="modal-content">
                                <div class="modal-header">
                                  <h5 class="modal-title" id="addAmountModalLabelA">Players of Team-A</h5>
                                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                  </button>
                                </div>
                                <div class="modal-body">
                                  <div id="playerCheckboxesA">
                                    <!-- Checkboxes for Team A will be inserted here dynamically -->
                                  </div>
                                </div>
                                <div class="modal-footer">
                                  <button type="button" data-dismiss="modal" id="saveSelectedPlayersBtnA" class="btn btn-primary1"
                                    onclick="saveSelectedPlayersA()">Submit</button>
                                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-xl-6 col-md-12 col-sm-11">
                    <div class="card p-2">
                      <div class="card-body">
                        <h3 class="text-center">Team B</h3>
                        <div class="container mt-3">
                          <div class="table-wrapper">
                            <table class="table table-bordered text-center">
                              <thead>
                                <tr>
                                  <th>No</th>
                                  <th colspan="3">Name</th>
                                  <th>Pic</th>
                                  <th>Disable</th>
                                </tr>
                              </thead>
                              <tbody id="tbody2">
                                <!-- Player rows for Team B -->
                              </tbody>
                            </table>
                          </div>
                          <div class="d-flex justify-content-end mt-3">
                            <button class="btn btn-primary1 m-1" id="user-deduction" data-toggle="modal"
                              data-target="#deductAmountModal">+ Add Player Alternate...</button>
                            <!-- <button class="btn btn-primary1" onclick="addPair('B')"></button>  -->
                          </div>
                          <div class="modal fade" id="deductAmountModal" tabindex="-1"
                            aria-labelledby="addAmountModalLabelB" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                              <div class="modal-content">
                                <div class="modal-header">
                                  <h5 class="modal-title"  id="addAmountModalLabelB">Players of Team-B</h5>
                                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                  </button>
                                </div>
                                <div class="modal-body">
                                  <div id="playerCheckboxesB">
                                    <!-- Checkboxes for Team B will be inserted here dynamically -->
                                  </div>
                                </div>
                                <div class="modal-footer">
                                  <button type="button" data-dismiss="modal" id="saveSelectedPlayersBtnB" class="btn btn-primary1"
                                    onclick="saveSelectedPlayersB()">Submit</button>
                                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- Modal Structure -->


                  <!-- Deduct Amount Modal -->



                </div>



                <div class="col-xl-12 col-md-12 col-sm-11">

                  <div class="card p-2">
                    <div class="card-body">

                      <div class="container">
                        <div class="status-buttons">
                          <button class="btn btn-primary1 btn-ponter" id="statusShow">Status</button>
                          <button class="btn btn-primary1 mt-2" id="declareResult">Declare Result</button>
                        </div>
                        <div class="table-wrapper mt-3">
                          <table class="table table-bordered text-center">
                            <thead>
                              <tr>
                                <th>No</th>
                                <th>Username</th>
                                <th>Enter Amount</th>
                                <th>Pair</th>
                                <th>Total Pool</th>
                                <th>Refund/Kick</th>
                              </tr>
                            </thead>
                            <tbody>

                            </tbody>
                          </table>
                        </div>
                      </div>


                    </div>
                  </div>
                </div>
              </div>



              <footer class="footer">
                <div class="container-fluid">
                  <div class="row">
                    <div class="col-sm-6">2024 © Krinik.</div>
                    <div class="col-sm-6">
                      <div class="text-sm-end d-none d-sm-block">
                        Crafted with <i class="mdi mdi-heart text-danger"></i> by
                        Themesdesign
                      </div>
                    </div>
                  </div>
                </div>
              </footer>


            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</body>

<script>
  var rankList = [];
  var array = [];
  var array_length = 0;
  var table_size = 10;
  var start_index = 1;
  var end_index = 0;
  var current_index = 1;
  var max_index = 0;// Define end_index or calculate based on data length
  // Define end_index or calculate based on data length
  let disablePlayersA = []
  let disablePlayersB = []
  const urlParams = new URLSearchParams(window.location.search);
  const id = urlParams.get('id');
let remainTiming = document.querySelector('#remainTiming')
let statusShow = document.getElementById('statusShow')
let urlpooltime

  async function fetchUserData() {
    try {
      if (!id) {
        console.warn('No player ID found in URL.');
        return;
      }

      const url = `https://krinik.pythonanywhere.com/match_get/${id}/`;
      console.log('Fetching player data from:', url);

     
        const url1 = `https://krinik.pythonanywhere.com/pool_declare/`;
        console.log('Fetching player data from:', url1);

        const responseurl = await fetch(url1);
        const urlpool =await responseurl.json()
        const urlpooldata = urlpool.data

        const urlpool1 = urlpooldata.find((p)=>p.select_match.match_id == id)
        if(urlpool1){

          urlpooltime = urlpool1.date_time
        }

       
    console.log(urlpooltime,"poll")
      const response = await fetch(url);
      
      if (!response.ok) {
        throw new Error('Failed to fetch player data');
      }
      
      const userData1 = await response.json();
      const userData = userData1.data;
      
      userId = userData.id;

      console.log(userData, "data");
      editPlayerData(userData);
      // fetchData(userId)

    } catch (error) {
      console.error('Error fetching player data:', error);
    }
  }


  function editPlayerData(response) {
    const teamLogo1 = document.getElementById("team-logo-1");
    const teamLogo2 = document.getElementById("team-logo-2");
    const teamLogoName1 = document.getElementById("team-logo-name-1");
    const teamLogoName2 = document.getElementById("team-logo-name-2");

    if (response) {
      teamLogo1.src = `https://krinik.pythonanywhere.com${response.select_team_A.team_image}`;
      teamLogo2.src = `https://krinik.pythonanywhere.com${response.select_team_B.team_image}`;

      teamLogoName1.textContent = response.select_team_A.team_name;
      teamLogoName2.textContent = response.select_team_B.team_name;

let defaultTime = new Date();  // Current date and time
console.log(defaultTime.getTime(), "defaultTime");

// Example match start and end dates from response
const matchStartDate = response.match_start_date;  // Example: "11-09-2024 17:15"
const matchEndDate = urlpooltime ? urlpooltime : null;  // If urlpooltime is available, use it; otherwise, it's null.

const matchDateTimeStr = matchStartDate.replace("/", "-"); // Ensures compatibility with Date parsing
console.log(matchDateTimeStr, "matchDateTimeStr");

let matchDateTimeStrEnd = null;
if (matchEndDate) {
    matchDateTimeStrEnd = matchEndDate.replace("/", "-"); // Ensures compatibility with Date parsing
    console.log(matchDateTimeStrEnd, "matchDateTimeStrEnd");
}

// Use moment.js to parse the match start and end dates
const formattedMatchDate = moment(matchDateTimeStr, 'DD-MM-YYYY HH:mm');  // Match start as a moment object
let formattedMatchEndDate = null;
if (matchDateTimeStrEnd) {
    formattedMatchEndDate = moment(matchDateTimeStrEnd, 'YYYY-MM-DD HH:mm:ss');  // Match end as a moment object
    console.log(formattedMatchEndDate.format('DD-MM-YYYY HH:mm:ss'), "formattedMatchEndDate");
}

console.log(formattedMatchDate.format('DD-MM-YYYY HH:mm:ss'), "formattedMatchDate");

// Function to update the live countdown and status
function updateCountdown() {
    // Get the current time
    let currentTime = moment();  // Current time as a moment object
    console.log(currentTime.format('DD-MM-YYYY HH:mm:ss'), "Current Time");

    // Calculate the remaining time until match start
    let remainingTimeStart = formattedMatchDate.diff(currentTime);
    let remainingTimeEnd = formattedMatchEndDate ? formattedMatchEndDate.diff(currentTime) : null;

    // Check the current status
    if (remainingTimeStart > 0) {
        // Match hasn't started yet
        statusShow.textContent = "Upcoming";

        // Convert the remaining time to a human-readable format for the countdown
        let duration = moment.duration(remainingTimeStart);
        let formattedRemainingTime = `${duration.months()} months, ${duration.days()} days, ${duration.hours()} hours, ${duration.minutes()} minutes, ${duration.seconds()} seconds`;
        remainTiming.textContent = formattedRemainingTime;

    } else if (remainingTimeStart <= 0 && (!remainingTimeEnd || remainingTimeEnd > 0)) {
        // Match is live if either:
        // - It has started and the end time is not provided, OR
        // - It has started and the current time is between the start and end time
        statusShow.textContent = "Live";
        remainTiming.textContent = "Live";
        
    } else if (remainingTimeEnd && remainingTimeEnd <= 0) {
        // Match has ended if we have the end date and the current time is past the end date
        statusShow.textContent = "Completed";
        remainTiming.textContent = "Completed";

        // Stop the countdown as the match is completed
        clearInterval(countdownInterval);
    }
}

// Start the countdown and update every second (1000 ms)
let countdownInterval = setInterval(updateCountdown, 1000);

// Initial call to display countdown immediately
updateCountdown();


      selectingPlayerA = response.select_player_A
      selectingPlayerB = response.select_player_B
      console.log(selectingPlayerA,"olp")
      // disablePlayersA = response.disable_player_A
      // disablePlayersB = response.disable_player_B
      disablePlayersA = (response.disable_player_A || []).map(player => ({
        ...player,
        disable: "disable"
      }))
      console.log(disablePlayersA, "oklp")
      disablePlayersB = (response.disable_player_B || []).map(player => ({
        ...player,
        disable: "disable"
      }))

      let aPlayer = [...disablePlayersA,...selectingPlayerA, ]
      let bPlayer = [...disablePlayersB,...selectingPlayerB, ]

      console.log(aPlayer, "yui")

      console.log(disablePlayersA, "ok1")
      displayTableRows(aPlayer, "tbody1");
      displayTableRows(bPlayer, "tbody2");
    } else {
      console.error("Data is not in the expected format:", response);
    }
  }


  function displayTableRows(players, tbodyId) {
    $("#" + tbodyId).empty();

    players.forEach((player, index) => {
      const tr = $("<tr></tr>");

      const noCell = $("<td></td>").text(index + 1);
      const playerNameCell = $("<td colspan='3'></td>").text(player.player_name);
      const logoCell = $("<td class='team-logo1'></td>").html(
        player.player_image
          ? `<img src="https://krinik.pythonanywhere.com${player.player_image}" alt="" />`
          : ""
      );
      const disableCell = $("<td></td>").html(`
            <span class="material-symbols-outlined" style="color:#E20101; cursor:pointer;" onclick="handleDisable(${player.id})">
                block
            </span>
        `);
      const dis = player.disable
      console.log(dis, "dis")

      if (dis == "disable") {
        noCell.addClass("disabled-row")
        playerNameCell.addClass("disabled-row")
        logoCell.addClass("disabled-row")
        disableCell.addClass("disabled-row")

      }

      tr.append(noCell)
        .append(playerNameCell)
        .append(logoCell)
        .append(disableCell);

      $("#" + tbodyId).append(tr);
    });
  }

  async function handleDisable(playerId) {
    if (confirm('Are you sure you want to delete this player?')) {
      const matchUrl = `https://krinik.pythonanywhere.com/match_get/${id}/`;
      try {
        // Fetch existing match data
        const matchResponse = await fetch(matchUrl);
        if (!matchResponse.ok) {
          throw new Error('Failed to fetch match data');
        }
        const matchData = await matchResponse.json();

        const existingPlayersA = matchData.data.select_player_A || [];
        const existingPlayersB = matchData.data.select_player_B || [];
        disablePlayersA = matchData.data.disable_player_A
        disablePlayersB = matchData.data.disable_player_B

        const playerIndexA = existingPlayersA.findIndex(player => player.id === playerId);
        const playerIndexB = existingPlayersB.findIndex(player => player.id === playerId);

        if (playerIndexA !== -1) {
          // Remove the clicked player from the existingPlayersA list
          const updatedPlayersA1 = [...existingPlayersA];
          const updatedPlayersA2 = [...existingPlayersA];

          updatedPlayersA1.splice(playerIndexA, 1);

          disablePlayers1 = updatedPlayersA2.splice(playerIndexA, 1);
          console.log(disablePlayers1)
          disablePlayers1.forEach(player => {
            disablePlayersA = [...disablePlayersA, player]; // Spread the player into the array
          });
          console.log(disablePlayersA, "ok2")
          // Patch the updated players list
          const response = await fetch(matchUrl, {
            method: 'PATCH',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              select_player_A: updatedPlayersA1.map(p => p.id),
              select_player_B: existingPlayersB.map(p => p.id),
              disable_player_A: disablePlayersA.map(p => p.id),
              disable_player_B: disablePlayersB.map(p => p.id)

            }),

          });


          if (response.ok) {
            console.log('Player successfully removed');
            // await fetchUserData();
             fetchUserData1();
             fetchUserData()
            // Refresh the user data to reflect the changes
          } else {
            const errorText = await response.text();
            console.error('Failed to update player data. Status:', response.status, errorText);
          }
        } else if (playerIndexB !== -1) {
          // Remove the clicked player from the existingPlayersB list
          const updatedPlayersB1 = [...existingPlayersB];
          const updatedPlayersB2 = [...existingPlayersB];

          updatedPlayersB1.splice(playerIndexB, 1);

          disablePlayers2 = updatedPlayersB2.splice(playerIndexB, 1);

          // disablePlayersB = [...disablePlayersB,disablePlayers2]

          disablePlayers2.forEach(player => {
            disablePlayersB = [...disablePlayersB, player]; // Spread the player into the array
          });

          // Patch the updated players list
          const response = await fetch(matchUrl, {
            method: 'PATCH',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              select_player_B: updatedPlayersB1.map(p => p.id),
              select_player_A: existingPlayersA.map(p => p.id),
              disable_player_A: disablePlayersA.map(p => p.id),
              disable_player_B: disablePlayersB.map(p => p.id)

            }),


          });

          if (response.ok) {
            console.log('Player successfully removed');
            // await fetchUserData(); // Refresh the user data to reflect the changes
             fetchUserData1();
             fetchUserData()

          } else {
            const errorText = await response.text();
            console.error('Failed to update player data. Status:', response.status, errorText);
          }
        } else {
          console.error('Player not found in existing players');
        }
      } catch (error) {
        console.error('Error removing player:', error);
      }
      // window.location.reload()
    }
  }

  async function fetchUserData1() {
    try {
      if (!id) {
        console.warn('No player ID found in URL.');
        return;
      }

      const url = `https://krinik.pythonanywhere.com/match_get/${id}/`;
      console.log('Fetching player data from:', url);

      const response = await fetch(url);
      if (!response.ok) {
        throw new Error('Failed to fetch player data');
      }

      const userData1 = await response.json();
      const userData = userData1.data;
      userId = userData.id;

        const leagueNameData = userData.select_league.league_name
        
      const teamA = userData.select_team_A.id;
      const teamB = userData.select_team_B.id;
      const playersA = userData.select_player_A;
      const playersB = userData.select_player_B;
      disableplayersA = userData.disable_player_A;
      disableplayersB = userData.disable_player_B

      console.log(disableplayersA, disableplayersB, "data3");

      await fetchPlayer(teamA, playersA, disableplayersA, 'playerCheckboxesA', leagueNameData); // Fetch players for Team A
      await fetchPlayer(teamB, playersB, disableplayersB, 'playerCheckboxesB', leagueNameData);
      fetchData(userId);


    } catch (error) {
      console.error('Error fetching player data:', error);
    }
  }


  async function fetchData(userId) {
    try {
      const response = await fetch(`https://krinik.pythonanywhere.com/view_contest_details_view_get/`);
      if (!response.ok) {
        throw new Error('Failed to fetch pool history data');
      }

      const userData1 = await response.json();

      if (userData1 && userData1.status === "success" && userData1.data) {
        rankList = userData1.data;
        console.log(rankList, "arr");
        // const totalAmountData = document.getElementById("total-amount-data")
        // const totalWinData = document.getElementById("total-win-data")
        // const totalAvailableData = document.getElementById("total-available-data")

        // totalAmountData.textContent = rankList.

        // Filter and log matching data
        const matchingData = rankList.filter(item => item.user_data.id === userId);
        if (matchingData.length > 0) {
          console.log('Matching data found:', matchingData,"okk");
        } else {
          // console.log('No matching data found.');
        }

        array = matchingData;


        if (array.length) {

          filterAndDisplay()
        } else {
          // console.log('no data found')
        }
        // editPlayerData(array);
      } else {
        console.error("Error: Invalid data format or ID mismatch");
      }
    } catch (error) {
      console.error("Error fetching data", error);
    }
  }

  function filterAndDisplay() {
    // filterRankList();
    preLoadCalculations();
    displayIndexButtons();
    displayTableRows1();
    highlightIndexButton();
  }

  function preLoadCalculations(filteredArrayLength) {
    array_length = filteredArrayLength || array.length;
    max_index = Math.ceil(array_length / table_size);
  }


  function displayIndexButtons() {
    $(".index_buttons ul").empty();

    if (array_length <= table_size) {
      // If there are 10 or fewer items, do not show pagination
      return;
    }

    if (current_index > 1) {
      $(".index_buttons ul").append('<li><button class="paginate_button page-item previous" onclick="prev()">Previous</button></li>');
    }

    const show_page = getElidedPageRange(current_index, max_index);

    show_page.forEach(i => {
      if (i === current_index) {
        $(".index_buttons ul").append('<li><button class="paginate_button page-item active">' + i + '</button></li>');
      } else if (i === "...") {
        $(".index_buttons ul").append('<li><button class="paginate_button page-item">...</button></li>');
      } else {
        $(".index_buttons ul").append('<li><button class="paginate_button page-item" onclick="indexPagination(' + i + ')">' + i + '</button></li>');
      }
    });

    if (current_index < max_index) {
      $(".index_buttons ul").append('<li><button class="paginate_button page-item next" onclick="next()">Next</button></li>');
    }

    highlightIndexButton();
  }


  function getElidedPageRange(current, total) {
    const delta = 1;
    const range = [];
    const left = current - delta;
    const right = current + delta + 1;
    let last = 0;

    for (let i = 1; i <= total; i++) {
      if (i === 1 || i === total || (i >= left && i < right)) {
        if (last + 1 !== i) {
          range.push("...");
        }
        range.push(i);
        last = i;
      }
    }

    return range;
  }

  function highlightIndexButton() {
    start_index = (current_index - 1) * table_size + 1;
    end_index = Math.min(start_index + table_size - 1, array_length);
    $("#datatable_info").text("Showing " + start_index + " to " + end_index + " of " + array_length + " items");
    $(".index_buttons ul a").removeClass("active");
    $('.index_buttons ul a').each(function () {
      if ($(this).text() == current_index) {
        $(this).addClass("active");
      }
    });
    displayTableRows1();
  }
  function prev() {
    if (current_index > 1) {
      current_index--;
      displayIndexButtons();
      highlightIndexButton();
    }
  }

  function next() {
    if (current_index < max_index) {
      current_index++;
      displayIndexButtons();
      highlightIndexButton();
    }
  }

  function indexPagination(index) {
    current_index = index;
    displayIndexButtons();
    highlightIndexButton();
  }



  function displayTableRows1() {

    $("table tbody").empty();
    var tab_start = start_index - 1;
    var tab_end = end_index;

    if (array.length === 0) {
      $("#noDataFound").show();
      $("#pagination").hide();
      $("#table-scrolling").css("overflow-x", "hidden"); // Add this line
      return;
    } else {
      $("#noDataFound").hide();
      $("#pagination").show();
      $("#table-scrolling").css("overflow-x", "auto"); // Add this line
    }

    for (var i = tab_start; i < tab_end; i++) {
      var showdata = array[i];
      // var status = getStatus(showdata["start_league_date"], showdata["end_league_date"]);

      var tr = $("<tr></tr>");

      var noCell = $("<td></td>").text(i + 1);
      var userNameCell = $("<td colspan='2'></td>").text(showdata.user_data["name"] || "");
      var amountCell = $("<td colspan='2'> </td>").text(showdata["entry_fee"] || "");

 
      var pairCell = $("<td colspan='2'></td>").text(showdata.user_data["pool_name"].length || "");
      var totalPoolCell = $("<td colspan='2'> </td>").text(showdata["player_pair"].length || "");

     
      var deleteCell = $("<td></td>").html(
        '<span class="sortable" onclick="handleDelete(' + showdata["id"] + ')"><i class="far fa-trash-alt"></i></span>'
      );

      tr.append(noCell)
        .append(userNameCell)
        .append(amountCell)
        .append(pairCell)
        .append(totalPoolCell)
        // .append(logoCell)
        // .append(dateCell)
        // .append(statusCell)
        // .append(viewCell)
        // .append(editCell)
        .append(deleteCell);



      $("table tbody").append(tr);
    }
  }

  function redirectToHistoryPage(page) {
    const urlParams = new URLSearchParams(window.location.search);
    const name = urlParams.get('name');

    if (id) {
      window.location.href = `${page}.html?id=${id}`;
    } else {
      console.error('No player ID found in URL.');
    }
  }

  document.getElementById("declareResult").addEventListener("click", () => redirectToHistoryPage('declare-result'));




  // Function to open the modal and populate it with checkboxes
  async function fetchPlayer(teamName, playersName, disablePlayers, checkboxContainerId, leagueNameData) {
    try {
      const response = await fetch('https://krinik.pythonanywhere.com/player_get/');
      if (!response.ok) {
        throw new Error('Failed to fetch player data');
      }

      const userData1 = await response.json();

      if (userData1 && userData1.status === "success" && userData1.data) {
        const rankList = userData1.data;

        
        console.log(rankList,"league che")
        // Filter players by team name
        const matchingData = rankList.filter(item => item.team_name.id === teamName && item.league_name === leagueNameData);
        console.log(matchingData,'matchdata che')
        if (matchingData.length > 0) {
          // Filter out players already in playersName and those in disablePlayers
          const playerFilters = matchingData.filter(play =>
            !playersName.some(p => p.id === play.id) &&
            !disablePlayers.some(p => p.id === play.id)
          );

          const playerCheckboxes = document.getElementById(checkboxContainerId);
          playerCheckboxes.innerHTML = ''; // Clear previous checkboxes

          playerFilters.forEach(player => {
            const checkboxDiv = document.createElement('div');
            checkboxDiv.className = 'form-check';

            const checkboxInput = document.createElement('input');
            checkboxInput.type = 'checkbox';
            checkboxInput.className = 'form-check-input';
            checkboxInput.id = `player-${player.id}`;
            checkboxInput.value = player.id;

            const checkboxLabel = document.createElement('label');
            checkboxLabel.className = 'form-check-label';
            checkboxLabel.htmlFor = `player-${player.id}`;
            checkboxLabel.textContent = player.player_name;

            checkboxDiv.appendChild(checkboxInput);
            checkboxDiv.appendChild(checkboxLabel);

            playerCheckboxes.appendChild(checkboxDiv);
      
          });
        } else {
          console.log('No matching data found.');
        }
      }
    } catch (error) {
      console.error('Error fetching player data:', error);
    }
  }

  async function saveSelectedPlayersA() {
    // Collect selected players for Team A
    const selectedPlayersA = Array.from(document.querySelectorAll('#playerCheckboxesA input[type="checkbox"]:checked'))
      .map(checkbox => ({
        id: checkbox.value,
        player_name: checkbox.nextElementSibling.textContent // Adjust according to your actual data structure
      }));

    console.log('Selected Players for Team A:', selectedPlayersA);

    // Fetch existing match data
    const matchUrl = `https://krinik.pythonanywhere.com/match_get/${id}/`;
    try {
      const matchResponse = await fetch(matchUrl);
      if (!matchResponse.ok) {
        throw new Error('Failed to fetch match data');
      }

      const matchData = await matchResponse.json();
      const existingPlayersA = matchData.data.select_player_A || [];
      // const existingPlayersA3 = matchData.data.select_player_A || [];
      const existingPlayersB = matchData.data.select_player_B || [];
      disableplayersA = matchData.data.disable_player_A;
      disableplayersB = matchData.data.disable_player_B
      const filteredExistingPlayersA = existingPlayersA.filter(p => !disableplayersA.includes(p.id));
      // const filteredExistingPlayersA3 = existingPlayersA3.filter(p => disablePlayersA.includes(p.player_name));
      console.log(filteredExistingPlayersA, "oklp")
      // Merge existing players with new selected players
      const updatedPlayersA = [...filteredExistingPlayersA, ...selectedPlayersA];

      // Save the updated players list
      const response = await fetch(matchUrl, {
        method: 'PATCH',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          select_player_A: updatedPlayersA.map(p => p.id),
          select_player_B: existingPlayersB.map(p => p.id),
          disable_player_A: disableplayersA.map(p => p.id),
          disable_player_B: disableplayersB.map(p => p.id),

          // Send the entire array
        })
      });

      if (!response.ok) {
        const errorText = await response.text();
        console.error('Error response:', errorText);
        throw new Error('Failed to save selected players for Team A');
      }

      
      if (response.ok) {
        // console.log('Player successfully removed');
        // await fetchUserData(); // Refresh the user data to reflect the changes
        fetchUserData1();
        fetchUserData()
      }
     

      const result = await response.json();
      console.log('Save result for Team A:', result);
      // Handle success (e.g., show a success message)
      // alert('Selected players for Team A saved successfully!');
    } catch (error) {
      console.error('Error saving selected players for Team A:', error);
      alert('Failed to save selected players for Team A.');
    }

    // Close the modal

  }
  // $('#addAmountModal').modal('hide');
  async function saveSelectedPlayersB() {
    // Collect selected players for Team B
    const selectedPlayersB = Array.from(document.querySelectorAll('#playerCheckboxesB input[type="checkbox"]:checked'))
      .map(checkbox => ({
        id: checkbox.value,
        player_name: checkbox.nextElementSibling.textContent
      }));

    console.log('Selected Players for Team B:', selectedPlayersB);

    // Fetch existing match data
    const matchUrl = `https://krinik.pythonanywhere.com/match_get/${id}/`;
    try {
      const matchResponse = await fetch(matchUrl);
      if (!matchResponse.ok) {
        throw new Error('Failed to fetch match data');
      }

      const matchData = await matchResponse.json();
      const existingPlayersA = matchData.data.select_player_A || [];
      const existingPlayersB = matchData.data.select_player_B || [];
      // const existingPlayersB3 = matchData.data.select_player_B || [];

      disableplayersA = matchData.data.disable_player_A;
      disableplayersB = matchData.data.disable_player_B
      const filteredExistingPlayersB = existingPlayersB.filter(p => !disableplayersB.includes(p.id));
      // const filteredExistingPlayersB3 = existingPlayersB3.filter(p => disablePlayersB.includes(p.player_name));
      console.log(filteredExistingPlayersB, "oklp")
      const updatedPlayersB = [...filteredExistingPlayersB, ...selectedPlayersB];



      // Save the updated players list
      const response = await fetch(matchUrl, {
        method: 'PATCH',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          select_player_B: updatedPlayersB.map(p => p.id),
          select_player_A: existingPlayersA.map(p => p.id),
          disable_player_B: disableplayersB.map(p => p.id),
          disable_player_A: disableplayersA.map(p => p.id),
        })
      });

      if (!response.ok) {
        throw new Error('Failed to save selected players for Team B');
      }

      if (response.ok) {
        // console.log('Player successfully removed');
        // await fetchUserData(); // Refresh the user data to reflect the changes
        fetchUserData1();
             fetchUserData()
      }

      const result = await response.json();
      console.log('Save result for Team B:', result);
      // $('#deductAmountModal').modal('hide');
      // Handle success (e.g., show a success message)
      // alert('Selected players for Team B saved successfully!');
    } catch (error) {
      console.error('Error saving selected players for Team B:', error);
      alert('Failed to save selected players for Team B.');
    }

    // Close the modal

  }


  document.getElementById("saveSelectedPlayersBtnA").addEventListener("click", saveSelectedPlayersA);
  document.getElementById("saveSelectedPlayersBtnB").addEventListener("click", saveSelectedPlayersB);


  fetchUserData();

  fetchUserData1()





</script>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Bootstrap JS -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!-- Bootstrap JS and dependencies (jQuery and Popper.js) -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="assets/libs/jquery/jquery.min.js"></script>
<script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="assets/libs/metismenu/metisMenu.min.js"></script>
<script src="assets/libs/simplebar/simplebar.min.js"></script>
<script src="assets/libs/node-waves/waves.min.js"></script>

<script src="https://unicons.iconscout.com/release/v2.0.1/script/monochrome/bundle.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script src="./assets/js/logout.js"></script>

<script src="assets/js/app.js"></script>

</html>